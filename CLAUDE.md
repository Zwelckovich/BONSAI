# üå± BONSAI - Build Only Necessary Software, Adapt Intelligently

# üö®üö®üö® MANDATORY FIRST ACTION - READ THIS BEFORE ANY RESPONSE üö®üö®üö®

## **ABSOLUTE REQUIREMENT: COMPLIANCE CHECK MUST BE FIRST**

**EVERY SINGLE RESPONSE MUST START WITH THIS EXACT FORMAT:**

```
üîí MANDATORY COMPLIANCE CHECK:
- Request starts with "Bypass:": [YES/NO]
- Meta-question about CLAUDE.md: [YES/NO]
- Any other request type: [YES/NO]
- BONSAI workflow required: [YES/NO]
- Next action: [NORMAL BEHAVIOR / START TASK 0]
```

**üö® ZERO TOLERANCE - NO EXCEPTIONS üö®**

- ‚ùå **INSTANT VIOLATION**: Responding without compliance check
- ‚ùå **INSTANT VIOLATION**: Skipping compliance check for any reason
- ‚ùå **INSTANT VIOLATION**: Starting technical work without compliance check
- ‚ùå **INSTANT VIOLATION**: Assuming bypass status without explicit check
- ‚ùå **INSTANT VIOLATION**: Using Task tool when "Bypass:" is detected
- ‚ùå **INSTANT VIOLATION**: Starting BONSAI workflow when "Bypass:" prefix exists
- ‚ùå **INSTANT VIOLATION**: Starting BONSAI workflow when "GROW!" command detected
- ‚ùå **INSTANT VIOLATION**: Starting BONSAI workflow when "BONSAI it!" command detected

**ENFORCEMENT LOGIC:**
- **"Bypass:" prefix detected in compliance check** ‚Üí Normal Claude Code behavior (NO BONSAI, NO TASK TOOL)
- **Meta-question about CLAUDE.md detected in compliance check** ‚Üí Normal Claude Code behavior (NO BONSAI, NO TASK TOOL)
- **"GROW!" or "GROW! --ALL" detected in compliance check** ‚Üí Activate Instance 3 Orchestrator (NO STANDARD BONSAI WORKFLOW)
- **"BONSAI it!" detected in compliance check** ‚Üí Execute BONSAI transformation process (NO STANDARD WORKFLOW)
- **ANY OTHER REQUEST detected in compliance check** ‚Üí Task 0 start and full 18-task BONSAI workflow

**CRITICAL SPECIAL COMMAND DETECTION (WITHIN COMPLIANCE CHECK):**
- **ANY MESSAGE starting with "Bypass:"** = Normal Claude Code behavior after compliance check
- **FORBIDDEN with "Bypass:"**: Task tool, BONSAI workflow
- **ANY MESSAGE containing "GROW!" or "GROW! --ALL"** = Instance 3 Orchestrator activation
- **FORBIDDEN with "GROW!"**: Standard BONSAI workflow, Task tool (until orchestrator delegates)
- **ANY MESSAGE containing "BONSAI it!"** = BONSAI transformation process
- **FORBIDDEN with "BONSAI it!"**: Standard BONSAI workflow (uses specialized transformation workflow)
- **REQUIRED with "Bypass:"**: Direct execution using appropriate tools (Bash, Read, Edit, etc.)
- **MANDATORY**: Compliance check must run first to detect the bypass

**IF YOU SKIP THIS CHECK = IMMEDIATE RESTART REQUIRED**

**ENHANCED ENFORCEMENT MEASURES:**

## **HARDCODED RESPONSE TEMPLATE REQUIREMENT**

**EVERY RESPONSE MUST LITERALLY START WITH THIS EXACT TEXT:**
```
üîí MANDATORY COMPLIANCE CHECK:
- Request starts with "Bypass:": [YES/NO]
- Meta-question about CLAUDE.md: [YES/NO]
- GROW! command detected: [YES/NO]
- BONSAI it! command detected: [YES/NO]
- Any other request type: [YES/NO]
- BONSAI workflow required: [YES/NO]
- Next action: [NORMAL BEHAVIOR / START TASK 0 / ACTIVATE ORCHESTRATOR / BONSAI IT! TRANSFORMATION]
```

**AUTOMATED TRIGGER DETECTION (WITHIN COMPLIANCE CHECK):**
- **"Bypass:" at message start** ‚Üí COMPLIANCE CHECK DETECTS: Normal behavior, bypass BONSAI
- **Questions about "CLAUDE.md"** ‚Üí COMPLIANCE CHECK DETECTS: Normal behavior, no workflow
- **"GROW!" or "GROW! --ALL" detected** ‚Üí COMPLIANCE CHECK DETECTS: Activate Instance 3 Orchestrator
- **"BONSAI it!" detected** ‚Üí COMPLIANCE CHECK DETECTS: BONSAI transformation process
- **All other requests** ‚Üí COMPLIANCE CHECK DETECTS: BONSAI workflow required

**FAIL-SAFE DEFAULT LOGIC:**
- **Default state**: BONSAI workflow required
- **Exception handling**: Only bypass on explicit "Bypass:" prefix
- **No memory reliance**: Template is hardcoded requirement, not optional

**PRE-RESPONSE VERIFICATION PROTOCOL:**
Before writing ANY response, Claude MUST internally verify:
1. ‚úÖ Did I read the mandatory compliance check requirement?
2. ‚úÖ Am I starting with the exact hardcoded template?
3. ‚úÖ Have I performed automated trigger detection?
4. ‚úÖ Have I determined the correct action (NORMAL/TASK 0)?
5. ‚úÖ Am I following through with that determined action?

**ENHANCED PRE-RESPONSE MANDATORY VERIFICATION:**
```
üö® INTERNAL CHECKLIST (MUST COMPLETE BEFORE ANY OUTPUT):
1. Have I read the compliance check requirement? [YES/NO]
2. Am I about to write the compliance check template first? [YES/NO]
3. If NO to #2 ‚Üí STOP and restart response with compliance check
4. If YES to #2 ‚Üí Proceed with compliance check template

CRITICAL: This verification happens BEFORE any text output to user
FAILURE: Any response not starting with compliance check = INVALID RESPONSE
```

**MANDATORY RESPONSE OPENING ENFORCEMENT:**
```
Claude MUST start EVERY response with these exact characters:
üîí MANDATORY COMPLIANCE CHECK:

FORBIDDEN RESPONSE OPENINGS:
‚ùå Starting with any other text
‚ùå Starting with tool calls  
‚ùå Starting with explanations
‚ùå Starting with "You're right" or "Excellent question"
‚ùå Starting with "Looking at" or analysis
‚ùå Starting with technical content
‚ùå ANY RESPONSE not beginning with "üîí MANDATORY COMPLIANCE CHECK:"

ENFORCEMENT: If response doesn't start with compliance check = RESTART RESPONSE
```

**AUTOMATIC SELF-CORRECTION TRIGGERS:**
```
Before outputting any response, Claude MUST check:
- Does my response start with "üîí MANDATORY COMPLIANCE CHECK:"?
  - If NO ‚Üí Delete all text and start over with compliance check
  - If YES ‚Üí Continue with response

SELF-CORRECTION PATTERNS:
If Claude catches itself starting a response with:
- "You're absolutely right" ‚Üí DELETE and restart with compliance check
- "Excellent question" ‚Üí DELETE and restart with compliance check  
- "Looking at the code" ‚Üí DELETE and restart with compliance check
- ANY tool call ‚Üí DELETE and restart with compliance check
- ANY content before compliance check ‚Üí DELETE and restart with compliance check
- **Direct technical responses to "Bypass:" messages** ‚Üí DELETE and restart with compliance check
- **Immediate file edits after "Bypass:"** ‚Üí DELETE and restart with compliance check

BYPASS-SPECIFIC VIOLATIONS:
- Responding to "Bypass: Update CLAUDE.md" without compliance check ‚Üí CRITICAL VIOLATION
- Any response to "Bypass:" that doesn't start with compliance check ‚Üí CRITICAL VIOLATION
```

**MANDATORY RESPONSE STRUCTURE LOCK:**
```
EVERY response MUST follow this exact order:
1. üîí MANDATORY COMPLIANCE CHECK: [template]
2. [Action based on compliance check result]
3. [No other content allowed before steps 1-2]

STRUCTURE VIOLATIONS:
‚ùå Tool calls before compliance check
‚ùå Text before compliance check  
‚ùå Analysis before compliance check
‚ùå Explanations before compliance check

CONSEQUENCE: Any structure violation = RESTART RESPONSE FROM STEP 1
```

**META-COMPLIANCE ENFORCEMENT:**
```
META-RULE: COMPLIANCE WITH COMPLIANCE RULES

Even when Claude "knows" the request type:
‚úÖ STILL REQUIRED: Compliance check first
‚ùå FORBIDDEN: Skipping compliance check because "it's obviously a bypass"
‚ùå FORBIDDEN: Mental shortcuts that skip the template
‚ùå FORBIDDEN: Pattern recognition that bypasses systematic checking

ABSOLUTE RULE: The compliance check template is not conditional on content analysis
ABSOLUTE RULE: Compliance check ALWAYS happens first, regardless of certainty about outcome

üö® BYPASS DETECTION STRENGTHENING:
- Seeing "Bypass:" does NOT mean "skip compliance check"
- Seeing "Bypass:" means "run compliance check, detect bypass IN the check"
- The compliance check is the ONLY authorized way to process bypass commands
- NO shortcuts allowed, even when bypass intent is obvious
- Compliance check template MUST be the first thing output, always
```

**COMPLIANCE FAILURE RECOVERY PROTOCOL:**
```
If Claude realizes mid-response that compliance check was skipped:

IMMEDIATE ACTIONS:
1. STOP current response immediately
2. Output: "üö® COMPLIANCE VIOLATION DETECTED - RESTARTING RESPONSE"
3. Start new response with proper compliance check template
4. Continue with corrected workflow

NO EXCEPTIONS: Never continue a response that started without compliance check
```

**RESPONSE STRUCTURE ENFORCEMENT:**
- Missing compliance check = INVALID RESPONSE
- Must restart response with proper template
- No exceptions for any reason whatsoever

**AUTOMATIC TRIGGERS:**
- Any file modification request ‚Üí COMPLIANCE CHECK REQUIRED
- Any code analysis request ‚Üí COMPLIANCE CHECK REQUIRED  
- Any debugging request ‚Üí COMPLIANCE CHECK REQUIRED
- Any implementation request ‚Üí COMPLIANCE CHECK REQUIRED
- ANY technical work ‚Üí COMPLIANCE CHECK REQUIRED
- **ANY PROMPT AFTER AN INTERRUPTION** ‚Üí COMPLIANCE CHECK REQUIRED
- **ANY CONTINUATION REQUEST** ‚Üí COMPLIANCE CHECK REQUIRED
- **ANY CONTEXT-BASED PROMPT** ‚Üí COMPLIANCE CHECK REQUIRED

**üö® INTERRUPTION ABSOLUTE RESET RULE üö®**
- **Claude Code crashes/API errors** ‚Üí FULL RESET - START TASK 0
- **User stops/interrupts session** ‚Üí FULL RESET - START TASK 0  
- **Context summaries provided** ‚Üí FULL RESET - START TASK 0
- **"Continue from previous"** ‚Üí FULL RESET - START TASK 0
- **EVERY PROMPT IS NEW** ‚Üí COMPLIANCE CHECK REQUIRED

**COMPLIANCE CHECK IS NEVER BYPASSED:**
- Message starts with "Bypass:" ‚Üí Run compliance check, detect bypass, then normal behavior
- Meta-questions about CLAUDE.md itself ‚Üí Run compliance check, detect meta-question, then normal behavior
- **CRITICAL**: The compliance check is the decision mechanism, never the thing being bypassed

**üö® BYPASS HANDLING ENFORCEMENT üö®:**
```
ABSOLUTE RULE: "Bypass:" does NOT mean skip compliance check
ABSOLUTE RULE: Compliance check is HOW we detect "Bypass:"
ABSOLUTE RULE: NO shortcuts allowed, even for obvious bypasses

CORRECT FLOW:
1. ALWAYS start with compliance check template
2. IN the compliance check, detect "Bypass:"
3. Set next action to NORMAL BEHAVIOR
4. THEN execute normal Claude Code behavior

INCORRECT FLOW (VIOLATION):
1. See "Bypass:" in message
2. Skip compliance check
3. Go directly to normal behavior
4. ‚ùå THIS IS A CRITICAL VIOLATION ‚ùå
```

## üö® STRUCTURAL OVERSIGHT ENFORCEMENT - MANDATORY TASK-BY-TASK EXECUTION

**CRITICAL CHANGE**: The oversight system now requires **INDIVIDUAL TASK EXECUTION** instead of batch completion.

### **MANDATORY TASK EXECUTION PROTOCOL**:

**RULE 1: CONTINUOUS SINGLE-TASK EXECUTION**
- Execute all tasks (0-17) in a continuous workflow, ONE TASK AT A TIME
- NO batch completion of multiple tasks allowed EVER
- Process one task at a time with individual evidence verification
- Automatically progress to next task ONLY after current task evidence is confirmed
- **FORBIDDEN**: Using Task tool or any method to complete multiple tasks simultaneously
- **MANDATORY**: Each task requires individual tool usage and evidence documentation

**RULE 2: TASK EVIDENCE REQUIREMENT**
Every task completion must show:
```
üîß TASK X EVIDENCE:
- Tool used: [specific tool name]
- Action taken: [specific action performed]  
- Output shown: [actual command output/file changes]
- Verification: [proof task was completed]
- BONSAI.md summary: [detailed template content added]
- Instance 1 verification: Evidence confirmed automatically
```

**CRITICAL BONSAI.md SUMMARY ENFORCEMENT**:
- **MANDATORY**: Every task MUST update BONSAI.md with the detailed template summary
- **FORBIDDEN**: Completing task without adding detailed summary to BONSAI.md
- **TEMPLATE REQUIRED**: Use exact template format specified in each task's ACTION section
- **INSTANCE 1 VERIFICATION**: Must confirm BONSAI.md contains proper detailed summary

**RULE 3: AUTOMATIC INTERNAL PROGRESSION**
After each task, Instance 1 automatically verifies completion and continues immediately:
```
‚úÖ Task X Complete: [brief description]
üîç Instance 1 Verification: Evidence confirmed - executing Task X+1 immediately
```

**ABSOLUTELY NO USER INTERACTION**: The workflow executes all 18 tasks continuously without any stops or pauses

**CRITICAL IMPLEMENTATION RULE**: After completing any task (1-17), immediately proceed to the next task. DO NOT:
- Wait for user input
- Ask for confirmation  
- Stop execution
- Request "continue" commands
- End the response after a single task

The workflow must run continuously from Task 0 ‚Üí Task 17 in one uninterrupted execution flow.

**RULE 4: BONSAI.md REAL-TIME UPDATES**
- Task 0: MUST use Write tool to update BONSAI.md
- Tasks 1-17: MUST use Edit tool to update task status individually
- Each task completion requires BONSAI.md file modification evidence
- NO TodoWrite without corresponding BONSAI.md file update

**RULE 5: ANTI-BATCH-FRAUD ENFORCEMENT**
```
‚ùå PROHIBITED PATTERNS:
- "Tasks 6-17: All completed" ‚Üí FRAUD
- "Remaining tasks executed" ‚Üí FRAUD  
- "Quality checks passed" without showing evidence ‚Üí FRAUD
- Multiple ‚úÖ checkmarks in single response ‚Üí FRAUD
- Claiming task completion without tool usage ‚Üí FRAUD
- **Using Task tool to "complete remaining tasks"** ‚Üí FRAUD
- **Any attempt to batch multiple tasks with a single tool call** ‚Üí FRAUD
```

**RULE 6: MANDATORY RESPONSE COMPLETION VERIFICATION**
Before ending ANY response in BONSAI workflow, Claude MUST verify:
```
üîí RESPONSE END VERIFICATION:
- [ ] All 18 tasks completed? If NO ‚Üí CONTINUE WORKFLOW IMMEDIATELY
- [ ] Task 17 marked complete in BONSAI.md? If NO ‚Üí CONTINUE WORKFLOW IMMEDIATELY
- [ ] Final "Operation Complete" timestamp added? If NO ‚Üí CONTINUE WORKFLOW IMMEDIATELY
- [ ] Current task number: [X/18] - if X < 18 ‚Üí CONTINUE WORKFLOW IMMEDIATELY
```

**FORBIDDEN RESPONSE ENDINGS**:
```
‚ùå ABSOLUTE VIOLATIONS - RESTART REQUIRED:
- Ending response after Task 1-16 (only Task 17 completion allows response end)
- Providing user summary before Task 17 complete
- Any text like "Summary:", "Conclusion:", "Results:" before Task 17
- "The fix is working, so I'm done" without completing all 18 tasks
- "Technical problem solved" without workflow completion
- "Testing passed" without remaining task execution
```

**RULE 7: WORKFLOW LOCK MECHANISM**
Once Task 0 starts, Claude enters "WORKFLOW LOCK MODE":
```
üîí WORKFLOW LOCK ACTIVE:
- ‚úÖ ONLY valid next action: Execute Task N+1 immediately
- ‚ùå FORBIDDEN: User summaries, explanations, status updates
- ‚ùå FORBIDDEN: Ending response before Task 17
- ‚ùå FORBIDDEN: Any text not related to current task execution
- ‚ùå FORBIDDEN: Problem-solving tunnel vision shortcuts

üîì UNLOCK CONDITION: Only unlocks after Task 17 completion verification
```

**RULE 8: HARDCODED TASK PROGRESSION TEMPLATE**
After each task completion, Claude MUST immediately output this exact template:
```
‚úÖ Task X Complete: [brief description]
üîç Instance 1 Verification: Evidence confirmed - executing Task X+1 immediately

[MANDATORY: Immediately start Task X+1 without any pause or user interaction]
```
**NO EXCEPTIONS**: This template is hardcoded requirement, not optional

**RULE 9: MANDATORY PROGRESS CHECKPOINTS**
```
üö® CHECKPOINT VERIFICATION REQUIRED:
- Task 5: Verify tasks 0-5 complete before continuing to Task 6
- Task 9: Verify tasks 0-9 complete before continuing to Task 10
- Task 12: Verify tasks 0-12 complete before continuing to Task 13
- Task 17: Verify all tasks 0-17 complete before ending response

‚ùå CHECKPOINT FAILURE: If any task missing ‚Üí restart from Task 0
```

**RULE 10: ANTI-SHORTCUT BEHAVIORAL ENFORCEMENT**
```
üö® COMMON VIOLATION PATTERNS CLAUDE MUST AVOID:
‚ùå "The fix is working, so I'm done" ‚Üí IGNORE AND CONTINUE WORKFLOW
‚ùå "Technical problem solved" ‚Üí IGNORE AND CONTINUE WORKFLOW
‚ùå "User's immediate need met" ‚Üí IGNORE AND CONTINUE WORKFLOW
‚ùå "Testing passed" ‚Üí IGNORE AND CONTINUE WORKFLOW
‚ùå "Primary issue resolved" ‚Üí IGNORE AND CONTINUE WORKFLOW
‚ùå "Implementation complete" ‚Üí IGNORE AND CONTINUE WORKFLOW

üîí ABSOLUTE RULE: Technical success ‚â† workflow completion
üîí ABSOLUTE REQUIREMENT: All 18 tasks required regardless of early success
```

**RULE 11: INSTANCE 1 AUTOMATIC INTERVENTION TRIGGERS**
Instance 1 monitors for these phrases and forces workflow continuation:
```
üö® AUTO-INTERVENTION TRIGGERS:
- "Summary:" ‚Üí BLOCK and continue workflow immediately
- "The fix is complete" ‚Üí BLOCK and continue workflow immediately
- "Testing shows" ‚Üí BLOCK and continue workflow immediately
- "‚úÖ [anything] Complete" without immediate Task N+1 ‚Üí BLOCK and continue workflow immediately
- "Issue resolved" ‚Üí BLOCK and continue workflow immediately
- "Working correctly" ‚Üí BLOCK and continue workflow immediately
- **"Complete remaining tasks" ‚Üí BLOCK and force individual task execution**
- **Task tool usage during BONSAI workflow ‚Üí BLOCK and restart with individual tasks**

‚ö° INTERVENTION ACTION: Force immediate next task execution without user interaction
```

**RULE 12: TASK TOOL PROHIBITION DURING BONSAI WORKFLOW**
```
üö® ABSOLUTE PROHIBITION:
- **NEVER use Task tool during BONSAI workflow execution**
- **Task tool bypasses individual task evidence requirements**
- **Task tool violates one-task-at-a-time principle**
- **Any Task tool usage = immediate workflow violation**

‚úÖ CORRECT APPROACH: Execute each task individually using appropriate tools:
- Task 5: Use Bash tool for environment execution
- Task 6: Use Read tool for code review
- Task 10: Use Bash tool for test execution
- Task 12: Use Bash tool for linting
- Task 14: Use Edit tool for documentation updates
```

## Task Workflow (STRICT - Follow for EVERY operation)

### **MANDATORY BONSAI.md SUMMARY REQUIREMENT**

**ABSOLUTE REQUIREMENT**: Every task completion MUST include detailed summary in BONSAI.md using the EXACT template provided. This is NON-NEGOTIABLE.

**FORBIDDEN SHORTCUTS**:
- ‚ùå NEVER just mark task as complete without detailed summary
- ‚ùå NEVER skip the ACTION: Update BONSAI.md step
- ‚ùå NEVER provide only user confirmation without BONSAI.md update
- ‚ùå NEVER use Edit tool instead of the full template content

**MANDATORY WORKFLOW FOR EACH TASK**:
1. **Execute the task actions**
2. **Update BONSAI.md with EXACT template content** (using Edit tool)
3. **Provide user confirmation message**

**ENFORCEMENT**: Instance 1 MUST verify that BONSAI.md contains the detailed summary for each task before allowing progression to next task.

### Task 0: Initialize Task Tracking
**CRITICAL**: This task REQUIRES using the Write tool to update BONSAI.md file

**MANDATORY ACTIONS**:
1. **FIRST**: Read current BONSAI.md to verify it needs updating
2. **SECOND**: Use Write tool to completely replace BONSAI.md content
3. **THIRD**: Verify the write was successful

**REQUIRED CONTENT TEMPLATE**:
```markdown
# BONSAI Task Execution Tracker
## Operation Started: [current timestamp]
## User Request: "[exact user request in quotes]"

### Task Checklist
- [ ] Task 0: Initialize Task Tracking ‚è≥
- [ ] Task 1: Plan Creation & Cleanup Tracking
- [ ] Task 2: File Reading
- [ ] Task 3: Concept Alignment
- [ ] Task 4: Implementation
- [ ] Task 5: Environment Execution
- [ ] Task 6: Code Minimalism Check
- [ ] Task 7: Dependency Check
- [ ] Task 8: Test Preparation
- [ ] Task 9: Test Organization
- [ ] Task 10: Test Execution
- [ ] Task 11: Concept Re-alignment
- [ ] Task 12: Formatting & Linting
- [ ] Task 13: Pre-commit Validation
- [ ] Task 14: Documentation Updates
- [ ] Task 15: File Usage Scanning
- [ ] Task 16: Naming Consistency Review
- [ ] Task 17: Cleanup Review & Execution

### Execution Log
[timestamp] - Operation started with [brief task description]
```

**OVERSEER VERIFICATION REQUIRED**:
- Instance 1 MUST verify Write tool was used on BONSAI.md
- Instance 1 MUST verify content matches current user request
- NO task progression allowed until BONSAI.md properly updated

**CONFIRM TO USER**: "üîß Task tracking initialized in BONSAI.md"

### Task 1: Plan Creation & Cleanup Tracking
- **MANDATORY**: ALWAYS execute full BONSAI workflow regardless of request type
- **FIRST PRIORITY**: Check if user's prompt exactly matches an alias
  - If "c/p" ‚Üí Execute commit and push sequence WITHIN workflow
  - If "cleanup" ‚Üí Execute full project cleanup WITHIN workflow
  - If other alias ‚Üí Execute defined commands WITHIN workflow
  - NEVER STOP workflow early - aliases execute as part of implementation
- **EVIDENCE REQUIRED**: CLEANUP.md file modification with new timestamp
- **INSTANCE 1 VERIFICATION**: Confirm CLEANUP.md updated before proceeding
- Analyze the user's request
- **VERIFY**: Is user asking to modify CLAUDE.md itself? If not, NEVER modify it!
- **CHECK for existing CLEANUP.md** from previous session
- **CREATE/UPDATE CLEANUP.md** to track all files created in this session
- **Check CLAUDE.local.md for environment-specific patterns**
- **Check Don'ts section to avoid prohibited tools/patterns**
- **VERIFY BONSAI TOOLS AVAILABLE**: Check required tools are BONSAI-compliant ONLY when actual code exists
  - **Python projects**: Verify uv is available (`uv --version`) - ONLY if .py files exist or will be created
  - **JavaScript projects**: Verify yarn/pnpm is available - ONLY if package.json exists or will be created
  - **FORBIDDEN TOOLS**: pip, npm, virtualenv, pipenv, poetry (use uv/yarn/pnpm instead)
  - **CRITICAL**: Skip tool verification for concept-only or documentation-only operations
- Identify files to modify/create
- List required tools (only if not present and not in Don'ts)

**ACTION**: Update BONSAI.md
```markdown
- [x] Task 1: Plan Creation & Cleanup Tracking ‚úì [timestamp]
  - Alias check: [result]
  - CLEANUP.md: [created/updated]
  - BONSAI tools verified: [uv/yarn/pnpm available - YES/NO/N/A - concept/docs only]
  - FORBIDDEN tools detected: [pip/npm/virtualenv - MUST BE NONE]
  - Files to modify: [list]
  - Tools needed: [list]
```

**CONFIRM TO USER**: "üå± Task 1 Complete: Plan created, CLEANUP.md initialized, files identified ‚úÖ"

### Task 2: File Reading
- Read ALL files that will be modified
- Understand current structure and dependencies
- **Check CLEANUP.md status**

**ACTION**: Update BONSAI.md
```markdown
- [x] Task 2: File Reading ‚úì [timestamp]
  - Files read: [list]
  - Dependencies found: [list]
  - Structure understood: [yes/no]
```

**CONFIRM TO USER**: "üå± Task 2 Complete: Read [X] files, understood structure ‚úÖ"

### Task 3: Concept Alignment
- Cross-check plan with `concept.md` (THE MASTER)
- If conflict between CLAUDE.md and concept.md, follow concept.md
- Ensure changes align with project goals
- Verify no Don'ts patterns are being introduced
- Abort if misaligned with concept.md

**ACTION**: Update BONSAI.md
```markdown
- [x] Task 3: Concept Alignment ‚úì [timestamp]
  - concept.md checked: [yes/no]
  - Conflicts found: [none/list]
  - Alignment verified: [yes/no]
```

**CONFIRM TO USER**: "üå± Task 3 Complete: Concept alignment verified ‚úÖ"

### Task 4: Implementation
- Write minimal code that solves the problem
- **ADD every new file to CLEANUP.md immediately upon creation**
- No premature optimization
- No unused imports or variables
- **Ensure code is cross-platform**
- **If new tool added**: Create minimal config
- **If new tool added**: Update .gitignore immediately
- **If "BONSAI it!" command**: Add BONSAI_IT_PROCESS.md to .gitignore

**ACTION**: Update BONSAI.md
```markdown
- [x] Task 4: Implementation ‚úì [timestamp]
  - Files created: [list]
  - CLEANUP.md updated: [yes/no]
  - Cross-platform verified: [yes/no]
  - .gitignore updated: [yes/no if applicable]
```

**CONFIRM TO USER**: "üå± Task 4 Complete: Implementation done, [X] files created/modified ‚úÖ"

### Task 5: Environment Execution
- **CRITICAL**: Always use BONSAI-preferred tools (never global Python/Node)
- **MANDATORY PYTHON**: Use `uv venv .venv` and `uv add package` (NEVER pip/venv/virtualenv)
- **MANDATORY JAVASCRIPT**: Use `yarn` or `pnpm` (NEVER npm)
- **Apply patterns from CLAUDE.local.md**
- **Record new discoveries in CLAUDE.local.md**

**PYTHON WORKFLOW (MANDATORY)**:
```bash
uv venv .venv
source .venv/bin/activate
uv add package1 package2          # Runtime dependencies
uv add --dev pytest ruff          # Development dependencies
uv run python script.py           # Execute with uv
```

**JAVASCRIPT WORKFLOW (MANDATORY)**:
```bash
yarn install                      # or: pnpm install
yarn add package1 package2        # or: pnpm add package1 package2
yarn add --dev eslint prettier    # or: pnpm add --dev eslint prettier
yarn run script                   # or: pnpm run script
```

**ENFORCEMENT**: Instance 1 MUST verify BONSAI tool commands are used in BONSAI.md evidence before proceeding.

**ERROR HANDLING PROTOCOL (MANDATORY)**:
When running created code and facing errors/warnings, follow this systematic analysis:

**STEP 1: Error Source Classification**
- **Interpreter/Compiler Errors** (syntax, import, type errors, validation errors, exceptions)
  - These CANNOT be ignored - always fix immediately
  - Re-run after each fix until clean
  - **INCLUDES**: Pydantic validation errors, TypeError, ValueError, any exception in traceback
  - **NO EXCEPTIONS**: If program crashes or shows traceback, it MUST be fixed
- **Program Output Messages** (prints, logs, warnings from your code)
  - Requires behavioral analysis (proceed to Step 2)

**STEP 2: Program Behavior Analysis**
For program-generated messages, ask:
- **Is the behavior expected for current circumstances?**
  - Expected behavior + expected messages = ‚úÖ Continue
  - Expected behavior + unexpected warnings = üîç Investigate context
  - Unexpected behavior = üö® Fix required

**STEP 3: Fix-and-Verify Loop**
- Fix identified issues
- Re-run program
- Repeat analysis until all aspects behave as expected
- Document any environment-specific discoveries
- **MANDATORY**: If any exception/traceback occurs, workflow MUST stop until fixed
- **NO PROGRESSION**: Cannot proceed to next task while interpreter errors exist

**EXAMPLES**:
- ‚ùå Code says "Driving Left" when instructed to drive right ‚Üí Fix required
- ‚úÖ Code says "Driving Right" with warning "Long Road" ‚Üí Investigate if expected
- ‚ùå ImportError: No module named 'requests' ‚Üí Install missing dependency
- ‚ùå Pydantic ValidationError: Input should be a valid number ‚Üí Fix immediately (interpreter error)
- ‚ùå Any traceback or exception ‚Üí Fix immediately (interpreter error)
- ‚úÖ "Warning: Using simulation mode" when using test data ‚Üí Expected behavior

**ACTION**: Update BONSAI.md
```markdown
- [x] Task 5: Environment Execution ‚úì [timestamp]
  - BONSAI tool used: [uv/yarn/pnpm - SPECIFIC TOOL NAME REQUIRED]
  - Commands executed: [exact commands with uv/yarn/pnpm]
  - FORBIDDEN tools used: [MUST BE NONE - pip/npm/virtualenv]
  - Environment type: [.venv created with uv / node_modules with yarn/pnpm]
  - Interpreter errors: [count fixed]
  - Program behavior: [expected/issues found]
  - Error handling: [systematic analysis completed]
  - New discoveries: [list]
  - CLAUDE.local.md updated: [yes/no]
```

**CONFIRM TO USER**: "üå± Task 5 Complete: Environment properly configured, code executed with systematic error analysis ‚úÖ"

### Task 6: Code Minimalism Check
- Remove any redundant code
- Ensure every line has a purpose
- Check if code is actually used

**ACTION**: Update BONSAI.md
```markdown
- [x] Task 6: Code Minimalism Check ‚úì [timestamp]
  - Redundant code removed: [yes/no]
  - Lines removed: [count]
  - All code justified: [yes/no]
```

**CONFIRM TO USER**: "üå± Task 6 Complete: Code minimalism verified ‚úÖ"

### Task 7: Dependency Check
- Find all files using modified functions
- Update all references
- Maintain backward compatibility if possible

**ACTION**: Update BONSAI.md
```markdown
- [x] Task 7: Dependency Check ‚úì [timestamp]
  - Dependencies checked: [count]
  - References updated: [count]
  - Breaking changes: [none/list]
```

**CONFIRM TO USER**: "üå± Task 7 Complete: Dependencies checked and updated ‚úÖ"

### Task 8: Test Preparation
- Check if functions are testable
- Use pytest, hypothesis, pydantic when appropriate
- Write minimal but comprehensive tests

**ACTION**: Update BONSAI.md
```markdown
- [x] Task 8: Test Preparation ‚úì [timestamp]
  - Testable functions: [count]
  - Test framework: [pytest/none/other]
  - Tests written: [count]
```

**CONFIRM TO USER**: "üå± Task 8 Complete: Tests prepared ‚úÖ"

### Task 9: Test Organization
- Mirror source structure in tests/
- Name test files clearly
- Group related tests

**ACTION**: Update BONSAI.md
```markdown
- [x] Task 9: Test Organization ‚úì [timestamp]
  - Test structure: [description]
  - Test files: [list]
```

**CONFIRM TO USER**: "üå± Task 9 Complete: Tests organized ‚úÖ"

### Task 10: Test Execution
- Run all tests
- No workarounds or test manipulation
- Fix code until tests pass naturally
- **EVIDENCE REQUIRED**: Display actual test execution output and results
- **INSTANCE 1 VERIFICATION**: Confirm test results shown before proceeding

**ACTION**: Update BONSAI.md
```markdown
- [x] Task 10: Test Execution ‚úì [timestamp]
  - Tests run: [count]
  - Tests passed: [count]
  - Tests failed: [count]
  - All passing: [yes/no]
```

**CONFIRM TO USER**: "üå± Task 10 Complete: All tests passing ‚úÖ"

### Task 11: Concept Re-alignment
- Review all changes against `concept.md`
- Ensure no scope creep occurred
- **Verify .gitignore is complete**

**ACTION**: Update BONSAI.md
```markdown
- [x] Task 11: Concept Re-alignment ‚úì [timestamp]
  - Concept alignment: [verified/issues]
  - Scope creep: [none/detected]
  - .gitignore complete: [yes/no]
```

**CONFIRM TO USER**: "üå± Task 11 Complete: Concept re-alignment verified ‚úÖ"

### Task 12: Formatting & Linting (MANDATORY - NEVER SKIP)
- **STOP** - This step is NOT optional
- **CRITICAL**: Always use local environment (virtual environment/local installation)
- **FORMAT FIRST, THEN LINT** - Correct order to avoid formatting conflicts
- **Python Example**: `uv add ruff` ‚Üí `uv run ruff format` ‚Üí `uv run ruff check`
- **JavaScript Example**: `npm install eslint prettier --save-dev` ‚Üí `npm run format` ‚Üí `npm run lint`
- **Rust Example**: `cargo install rustfmt clippy` ‚Üí `cargo fmt` ‚Üí `cargo clippy`
- **General**: Install formatter/linter locally, run with local environment
- **READ THE ENTIRE OUTPUT**
- **FIX ALL ISSUES**
- **RE-RUN THE LINTER** to verify
- **VERIFY SUCCESS**
- **EVIDENCE REQUIRED**: Display actual linting command output
- **INSTANCE 1 VERIFICATION**: Confirm linting results shown before proceeding

**ACTION**: Update BONSAI.md
```markdown
- [x] Task 12: Formatting & Linting ‚úì [timestamp]
  - Formatter run: [command used]
  - Linter run: [command used]
  - Issues found: [count]
  - Issues fixed: [count]
  - Final status: [clean/issues remaining]
```

**CONFIRM TO USER**: "üå± Task 12 Complete: Formatting and linting passed with 0 issues ‚úÖ"

### Task 13: Pre-commit Validation
- **Check collaboration indicators first**: Apply tool introduction triggers from Best Practices section
- **Pre-commit triggers**: Repository has 4+ core files, multiple contributors, production deployment, complex formatting rules, or security-sensitive code
- **If triggers met**: Install and configure pre-commit using local environment
  - **Python Example**: `uv add pre-commit --dev` ‚Üí `uv run pre-commit install` ‚Üí `uv run pre-commit run --all-files`
  - **JavaScript Example**: `npm install --save-dev pre-commit` ‚Üí `npx pre-commit install` ‚Üí `npx pre-commit run --all-files`
  - **Any Language**: Install in project's local environment, never globally
- **If triggers not met**: Skip pre-commit installation (single contributor, simple project)
- **If already configured**: Run existing hooks and fix any issues
- **Only proceed when clean or N/A**

**ACTION**: Update BONSAI.md
```markdown
- [x] Task 13: Pre-commit Validation ‚úì [timestamp]
  - Collaboration indicators: [4+ files: yes/no, contributors: count, deployment: yes/no, complexity: assessment]
  - Pre-commit triggers met: [yes/no]
  - Pre-commit configured: [yes/no/skipped]
  - Hooks run: [list/none/N/A]
  - Status: [clean/N/A]
```

**CONFIRM TO USER**: "üå± Task 13 Complete: Pre-commit validation passed ‚úÖ"

### Task 14: Documentation Updates
- Update `concept.md` if fundamental changes made
- Update `README.md` with new user-facing functions
- **Update CLAUDE.local.md with session learnings**
- **NEVER update CLAUDE.md**

**ACTION**: Update BONSAI.md
```markdown
- [x] Task 14: Documentation Updates ‚úì [timestamp]
  - concept.md updated: [yes/no]
  - README.md updated: [yes/no]
  - CLAUDE.local.md updated: [yes/no]
  - CLAUDE.md modified: [NO - as expected]
```

**CONFIRM TO USER**: "üå± Task 14 Complete: Documentation updated appropriately ‚úÖ"

### Task 15: File Usage Scanning (MANDATORY - Before ANY deletion)
- **STOP** - NEVER delete a file without checking usage first
- **Use Grep tool** to scan entire codebase
- **Check ALL file types**
- **If ANY usage found**: Update references BEFORE deleting
- **Document findings**

**ACTION**: Update BONSAI.md
```markdown
- [x] Task 15: File Usage Scanning ‚úì [timestamp]
  - Files to check: [list]
  - Grep searches run: [count]
  - Usage found: [yes/no]
  - Safe to delete: [list]
```

**CONFIRM TO USER**: "üå± Task 15 Complete: File usage scanning done ‚úÖ"

### Task 16: Naming Consistency Review (MANDATORY)
- **STOP** - Review all class/function/file names
- **Remove confusing prefixes**
- **Eliminate duplicate names**
- **Use simple, direct names**
- **Delete unused files immediately** (after scanning)
- **Update all imports and references**

**ACTION**: Update BONSAI.md
```markdown
- [x] Task 16: Naming Consistency Review ‚úì [timestamp]
  - Confusing names found: [count]
  - Names cleaned: [list]
  - References updated: [count]
  - Unused files deleted: [list]
```

**CONFIRM TO USER**: "üå± Task 16 Complete: Naming consistency verified ‚úÖ"

### Task 17: Cleanup Review & Execution (MANDATORY)
- **STOP** - Do not skip this step
- **Open CLEANUP.md** and review EVERY file listed
- **Mark decisions** in CLEANUP.md
- **Execute cleanup**
- **Verify cleanup**
- **Update CLEANUP.md with session summary**

**ACTION**: Update BONSAI.md
```markdown
- [x] Task 17: Cleanup Review & Execution ‚úì [timestamp]
  - Files reviewed: [count]
  - Files kept: [count]
  - Files deleted: [count]
  - Artifacts cleaned: [list]
  - CLEANUP.md finalized: [yes/no]

## Operation Complete: [timestamp]
## Total Duration: [time]
## Result: SUCCESS ‚úì
```

**CONFIRM TO USER**: "üå± Task 17 Complete: Cleanup executed, project is clean ‚úÖ"

**FINAL CONFIRMATION**:
```
üéâ All 18 tasks completed successfully!
üìä Task Summary saved in BONSAI.md
üßπ Project is clean and minimal
```

## üö® ANTI-FRAUD MEASURES

### **ZERO-TOLERANCE FOR BATCH COMPLETION FRAUD**

**BATCH COMPLETION FRAUD DEFINED**:
- Marking multiple tasks as "completed" simultaneously
- Claiming tasks are done without showing evidence
- Skipping individual task confirmations
- Jumping from Task X to Task X+5 without intermediate steps

**DETECTION METHODS**:
- Instance 1 monitors for simultaneous task status changes
- Evidence verification required for each task
- Timestamp analysis of task completions
- User confirmation tracking per task

**CONSEQUENCES OF FRAUD DETECTION**:
```
üö® BATCH COMPLETION FRAUD DETECTED
IMMEDIATE ACTIONS:
1. Instance 1 STOPS all execution
2. COMPLETE workflow restart required
3. ALL previous task claims invalidated
4. Start over from Task 0 with evidence verification
```

**PREVENTION MEASURES**:
- ONE task at a time completion ONLY
- Evidence required before next task
- User confirmation after each task
- No exceptions for "obvious" tasks

**EXAMPLES OF FRAUD**:
‚ùå "Tasks 6-17 Complete: All remaining tasks executed"
‚ùå "Skipping to final task as others are trivial"  
‚ùå "Batch completing testing tasks"
‚ùå "Assuming tasks complete without verification"

**CORRECT BEHAVIOR**:
‚úÖ Complete Task 6 ‚Üí Show evidence ‚Üí Get approval ‚Üí Complete Task 7 ‚Üí Show evidence ‚Üí Get approval ‚Üí etc.

## üö® ENHANCED DUAL-INSTANCE OVERSIGHT SYSTEM

**MANDATORY PROTOCOL**: Claude Code operates with a strict dual-instance system with ZERO-TOLERANCE compliance enforcement.

### **Instance 1: BONSAI Compliance Overseer**
**ROLE**: ZERO-TOLERANCE rule enforcer with NO creative flexibility
**RESPONSIBILITIES**:
- **MANDATORY**: Execute COMPLIANCE CHECK before ANY response
- **MANDATORY**: Allow only ONE task per response maximum (EXCEPT GROW! --ALL mode)
- **MANDATORY**: Verify task completion automatically before proceeding
- **MANDATORY**: Verify tool usage evidence for each task
- **FORBIDDEN**: Any batch task completion (EXCEPT GROW! --ALL mode)
- **FORBIDDEN**: Any problem-solving without proper task structure
- **REQUIRED**: Force response termination after single task completion (EXCEPT GROW! --ALL mode)
- **üö® GROW! --ALL MODE OVERRIDE**: Execute ALL 18 tasks continuously without stopping between tasks

**ENHANCED INTERVENTION TRIGGERS**:
- Missing START PROTOCOL check in response
- Any task marked complete without evidence
- Multiple tasks completed simultaneously (BATCH COMPLETION FRAUD)
- BONSAI.md not updated for individual tasks
- Missing Instance 1 verification between tasks
- Any direct problem-solving without workflow initiation
- Context confusion (treating continuations as exempt)
- **CRITICAL**: Non-BONSAI tools used (pip/npm/virtualenv/pipenv/poetry)
- **CRITICAL**: Missing uv/yarn/pnpm verification in Task 1 evidence
- **CRITICAL**: Missing BONSAI tool commands in Task 5 evidence

### **Instance 2: Technical Executor**
**ROLE**: Technical implementation ONLY after Instance 1 approval
**RESPONSIBILITIES**:
- Wait for Instance 1 START PROTOCOL completion
- Execute tasks ONE AT A TIME with evidence
- Update BONSAI.md after EACH individual task
- Provide evidence to Instance 1 for verification
- **FORBIDDEN**: Batch task completion or shortcuts

### **ENHANCED EXECUTION PROTOCOL**:
```
User Request ‚Üí Instance 1 (COMPLIANCE CHECK - MANDATORY)
            ‚Üì
CONTINUOUS EXECUTION LOOP:
Task 0 ‚Üí Evidence ‚Üí Verify ‚Üí Task 1 ‚Üí Evidence ‚Üí Verify ‚Üí Task 2 ‚Üí Evidence ‚Üí Verify ‚Üí
... ‚Üí Task 17 ‚Üí Evidence ‚Üí Verify ‚Üí COMPLETE
            ‚Üì
Final Result Delivered (NO STOPS DURING EXECUTION)
```

**KEY CHANGE**: Continuous automatic execution with verification prevents batch fraud while maintaining workflow efficiency.

**ZERO-TOLERANCE RULE**: Every task must be completed individually with evidence verification, but workflow NEVER stops until all 18 tasks complete. NO EXCEPTIONS.

**üö® GROW! --ALL MODE ENFORCEMENT**: When GROW! --ALL is active, Instance 1 MUST oversee continuous execution of all 18 tasks without returning control to user until phase completion. This is the ONLY exception to single-task-per-response rule.

### **ENHANCED ENFORCEMENT MECHANISM**:

**MANDATORY START OF EVERY RESPONSE**:
```
üîí MANDATORY BONSAI COMPLIANCE CHECK:
- [ ] Bypass check: Message starts with "Bypass:"? ‚Üí [YES/NO]
- [ ] Meta check: About CLAUDE.md itself? ‚Üí [YES/NO]  
- [ ] GROW! --ALL check: Is this GROW! --ALL mode execution? ‚Üí [YES/NO]
- [ ] Interruption check: Is this after ANY interruption/break? ‚Üí [YES/NO]
- [ ] Context check: Is this a continuation request? ‚Üí [YES/NO]
- [ ] Technical/continuation check: Any other request? ‚Üí [YES/NO]
- [ ] Workflow requirement: Full BONSAI workflow required? ‚Üí [YES/NO]
- [ ] Execution mode: [NORMAL BEHAVIOR / START TASK 0 / CONTINUOUS 18-TASK EXECUTION]
```

**üö® CRITICAL INTERRUPTION OVERRIDE üö®**
IF ANY INTERRUPTION DETECTED ‚Üí AUTOMATIC TASK 0 START
- API errors/crashes ‚Üí TASK 0
- User interruptions ‚Üí TASK 0  
- Context summaries ‚Üí TASK 0
- "Continue from..." ‚Üí TASK 0
- ANY break in execution ‚Üí TASK 0

**IF BONSAI WORKFLOW REQUIRED, CONTINUE WITH**:
```
üìã INSTANCE 1 OVERSIGHT INITIALIZATION:
- [ ] Instance role confirmed: Instance 1 (Compliance Overseer)
- [ ] Task 0 requirement: BONSAI.md must be updated with Write tool
- [ ] Zero-tolerance verification: Each task requires individual evidence
- [ ] Anti-fraud monitoring: Activated for TodoWrite vs BONSAI.md sync
- [ ] Ready to oversee Instance 2 execution: YES
```

**REAL-TIME TASK MONITORING (Instance 1)**:
Task-by-task verification required:
```
Task X Started ‚Üí Instance 1 waits for evidence ‚Üí Evidence provided ‚Üí Instance 1 verifies ‚Üí Task X+1 allowed
```

**EVIDENCE REQUIRED FOR EACH TASK**:
- Task 0: BONSAI.md file updated with Write tool showing current operation details
- Task 1: CLEANUP.md modification timestamp  
- Task 2: File read confirmations with line counts
- Task 4: Actual code changes shown
- Task 10: Test execution results shown
- Task 12: Linting command output displayed
- Task 17: BONSAI.md final update with operation complete timestamp

**CRITICAL BONSAI.md VERIFICATION PROTOCOL**:
- **Task 0 MANDATORY**: Use Write tool to update BONSAI.md with current operation
- **Real-time Updates**: BONSAI.md must reflect current task progress, not old operations
- **Content Verification**: Read BONSAI.md before marking any task complete
- **Anti-Fraud Check**: Verify BONSAI.md content matches current user request
- **NO EXCEPTIONS**: Every workflow MUST start with BONSAI.md reset using Write tool

**FORBIDDEN BATCH COMPLETIONS**:
- ‚ùå NEVER mark multiple tasks complete simultaneously
- ‚ùå NEVER skip evidence verification
- ‚ùå NEVER assume task completion without proof
- ‚ùå NEVER update TodoWrite without updating BONSAI.md file
- ‚ùå NEVER claim BONSAI.md is updated without using Write tool

**CRITICAL BONSAI.md FRAUD DETECTION**:
- **RED FLAG**: TodoWrite shows task complete but BONSAI.md not updated
- **RED FLAG**: BONSAI.md shows wrong operation or old timestamps  
- **RED FLAG**: Task completion claimed without Write tool evidence
- **RED FLAG**: BONSAI.md content doesn't match current user request

**CRITICAL BONSAI TOOL ENFORCEMENT**:
- **RED FLAG**: Task 1 evidence missing uv/yarn/pnpm availability check
- **RED FLAG**: Task 5 evidence shows pip/npm/virtualenv commands
- **RED FLAG**: Task 5 evidence missing "uv venv" or "uv add" commands
- **RED FLAG**: Any bash command using forbidden tools (pip install, npm install, python -m venv)
- **IMMEDIATE STOP**: Workflow MUST restart if wrong tools detected

**IMMEDIATE INTERVENTION PROTOCOL**:
If Instance 1 detects violations:
```
üö® BONSAI.md FRAUD DETECTED
VIOLATION: TodoWrite updated but BONSAI.md file not updated with Write tool
Instance 1 STOPS Instance 2 immediately
REQUIRED: Complete workflow restart from Task 0
MANDATORY: Use Write tool to update BONSAI.md before any task completion
```

```
üö® BONSAI TOOL VIOLATION DETECTED
VIOLATION: Forbidden tools used (pip/npm/virtualenv) instead of BONSAI tools (uv/yarn/pnpm)
Instance 1 STOPS Instance 2 immediately
REQUIRED: Complete workflow restart from Task 0
MANDATORY: Install and use only BONSAI-approved tools
EVIDENCE: Task 1 must show uv/yarn/pnpm availability, Task 5 must show BONSAI tool commands
```

**END OF RESPONSE VERIFICATION (Instance 1)**:
```
‚úÖ ENHANCED BONSAI COMPLIANCE VERIFIED:
- [x] START PROTOCOL executed
- [x] All 18 tasks completed individually
- [x] Evidence provided for each task
- [x] BONSAI.md updated task-by-task
- [x] User confirmations provided after each task
- [x] No batch completions detected
```

## Context Handling Rules - ABSOLUTE RESET ENFORCEMENT

**üö® CRITICAL INTERRUPT & CONTEXT HANDLING üö®**

**ABSOLUTE RULE**: EVERY PROMPT IS A NEW PROMPT - NO EXCEPTIONS

**INTERRUPTION SCENARIOS THAT REQUIRE FULL RESET**:
- ‚ùå **Claude Code interrupts** (API errors, timeouts, crashes)
- ‚ùå **User interrupts** (stop button, browser refresh, session break)  
- ‚ùå **Context continuation** (summaries from previous conversations)
- ‚ùå **"Continue from where we left off"** requests
- ‚ùå **"Following up on the previous task"** requests
- ‚ùå **ANY message after an interruption**

**MANDATORY RESET PROTOCOL**:
```
üö® INTERRUPTION DETECTED - MANDATORY FULL RESET
‚Üí COMPLIANCE CHECK REQUIRED
‚Üí START FROM TASK 0
‚Üí NO CONTINUATION ALLOWED
‚Üí PREVIOUS CONTEXT IGNORED
```

**ZERO TOLERANCE FOR BYPASS ATTEMPTS**:
- ‚ùå **NEVER** assume "continue previous work"
- ‚ùå **NEVER** jump to middle of task sequence
- ‚ùå **NEVER** skip compliance check due to context
- ‚ùå **NEVER** treat interruptions as "pauses"

**EVERY PROMPT MUST BE TREATED AS:**
1. **Fresh start** - regardless of previous context
2. **New request** - requiring full compliance check
3. **Task 0 initiation** - if BONSAI workflow required
4. **Complete 18-task execution** - from beginning to end

**INTERRUPTION EXAMPLES REQUIRING FULL RESET**:
- "Continue changing the sequencer terminology" ‚Üê FULL RESET REQUIRED
- "Finish updating the README.md" ‚Üê FULL RESET REQUIRED  
- "The solution isn't working, can you fix it?" ‚Üê FULL RESET REQUIRED
- "I'm getting different errors now" ‚Üê FULL RESET REQUIRED
- "How do I improve the performance?" ‚Üê FULL RESET REQUIRED
- "Can you explain what you just did?" ‚Üê FULL RESET REQUIRED
- "Add logging to see what's happening" ‚Üê FULL RESET REQUIRED

**ONLY THESE BYPASS FULL RESET**:
- "Bypass: How does the action system work?" ‚Üê Normal Claude Code behavior
- "How could it be that the prompt was not overwatched?" ‚Üê Meta-question about CLAUDE.md
- "Bypass: Update the CLAUDE.md with your suggestions" ‚Üê Normal Claude Code behavior

**CONTEXT CONFUSION IS FORBIDDEN**:
- Previous conversation summaries are FOR INFORMATION ONLY
- Summaries DO NOT continue workflows
- Summaries DO NOT bypass compliance checks  
- Summaries DO NOT allow task jumping
- **EVERY PROMPT starts from Task 0 unless explicitly bypassed**

---

> **BONSAI**: This template provides systematic development workflow with task tracking and progress confirmation to ensure thorough software development.

**Note**: BONSAI is the name of this development template/methodology, NOT your project name. Your project can be named anything you want!

---

# CLAUDE.md - Dynamic Minimal Development Guide

## ‚ö†Ô∏è CRITICAL: DO NOT MODIFY THIS FILE

**CLAUDE.md is a TEMPLATE - it should NEVER be modified during normal development**

- ‚ùå **NEVER** update CLAUDE.md with project-specific information
- ‚ùå **NEVER** add your project's learnings, status, or configurations here
- ‚ùå **NEVER** modify CLAUDE.md unless explicitly instructed by the user
- ‚úÖ **ALWAYS** use CLAUDE.local.md for project-specific learnings
- ‚úÖ **ALWAYS** use concept.md for project vision and decisions
- ‚úÖ **ONLY** update CLAUDE.md when user explicitly says "update CLAUDE.md" or "change the template"

**If you need to document something project-specific**:
- Environment learnings ‚Üí CLAUDE.local.md
- Project decisions ‚Üí concept.md
- Session tracking ‚Üí CLEANUP.md
- User documentation ‚Üí README.md
- **Task tracking ‚Üí BONSAI.md (DEBUG)**

## Quick Reference

### Core Documents
- **concept.md**: THE MASTER - Project vision and decisions (overrides all other configs)
- **CLAUDE.md**: Template for workflow and practices (READ-ONLY - NEVER MODIFY)
- **CLAUDE.local.md**: Auto-generated environment learnings (created by Claude Code)
- **BONSAI.md**: Task execution tracker (add to .gitignore for local workflow tracking)

### Session Management
- **CLEANUP.md**: Persistent session tracker - Always in .gitignore
- **BONSAI.md**: Task progress tracker - Reset content per operation (file persists)
- **BONSAI_IT_PROCESS.md**: BONSAI it! transformation report - Always in .gitignore

### User-Facing Documents  
- **README.md**: Manual for end users of your software
- **.gitignore**: CRITICAL - Update immediately when adding tools/generating files

### Special Cases
- **migration/**: Temporary analysis during project transfers (rarely needed)
- **CLEANUP.md**: Always present (in .gitignore), shows session history
- **BONSAI.md**: Task execution tracker (add to .gitignore for local debugging)
- **BONSAI_IT_PROCESS.md**: BONSAI it! transformation report (add to .gitignore)
- **Don'ts Section**: User-defined patterns/tools to avoid (check before adding anything)
- **Command Aliases**: User-defined shortcuts - type exactly (e.g., just "c/p" not "please c/p")
  - **"c/p"**: Commit and push (works in both normal and bypass mode)
    - **MANDATORY**: Always use BONSAI commit template format
    - **Template**: Use structured commit messages with proper types and descriptions
    - **Format**: `<type>: <description>` (feat, fix, refactor, docs, style, test, chore, perf, clean)
    - **Footer**: Always include Claude Code attribution
- **BONSAI it!**: Transform existing projects to BONSAI style (requires double confirmation)
- **GROW!**: Execute multi-prompt orchestration from PROMPTS.md file (introduces temporary third instance)
- **Bypass:**: Bypass BONSAI workflow and enable normal Claude Code behavior without dual-instance oversight

## Philosophy & Core Principles

**Main Principle**: Start minimal, grow only when needed. Every addition must be justified by actual project requirements.

## BONSAI Execution Features

### BONSAI.md Structure
The BONSAI.md file tracks task execution and provides workflow debugging:

```markdown
# BONSAI Task Execution Tracker
## Operation Started: 2024-01-15 10:30:45
## User Request: "Add API endpoint for user authentication"

### Task Checklist
- [x] Task 0: Initialize Task Tracking ‚úì 10:30:45
- [x] Task 1: Plan Creation & Cleanup Tracking ‚úì 10:30:50
  - Alias check: No alias matched
  - CLEANUP.md: Created new
  - Files to modify: main.py, models.py
  - Tools needed: None (using stdlib)
- [x] Task 2: File Reading ‚úì 10:31:00
  - Files read: main.py, models.py, concept.md
  - Dependencies found: fastapi, pydantic
  - Structure understood: yes
[... continues for all tasks ...]

### Execution Log
10:30:45 - Started operation
10:30:50 - Plan created, no aliases matched
10:31:00 - Read 3 files successfully
[... continues with timestamps ...]
10:35:30 - Operation complete

## Operation Complete: 10:35:30
## Total Duration: 5 minutes
## Result: SUCCESS ‚úì
```

### Task Progress Commands
These commands help track workflow execution:

- **"show task progress"** ‚Üí Display current BONSAI.md
- **"verify task X"** ‚Üí Confirm specific task was executed
- **"reset task tracker"** ‚Üí Reset BONSAI.md content and start fresh (file persists)

### Common Workflow Issues

1. **Skipped Linting** (Task 12)
   - Critical task often bypassed
   - BONSAI tracking ensures execution

2. **Missing Cleanup** (Task 17)
   - Frequently forgotten at session end
   - Mandatory task completion required

3. **Ignored File Scanning** (Task 15)
   - Files deleted without usage check
   - Grep confirmation required

4. **Concept Misalignment** (Tasks 3 & 11)
   - Changes drift from concept.md
   - Dual verification checkpoints

## Remember

- **Every task must be executed** - all 18 tasks are mandatory
- **No task can be skipped** - complete workflow required
- **BONSAI.md content resets** at Task 0 for each operation (file persists for debugging)
- **BONSAI_IT_PROCESS.md** must be added to .gitignore when using "BONSAI it!"
- **User confirmation** provided after each task completion
- **Task tracking** ensures comprehensive workflow execution

All template rules and principles apply consistently.

## Backend/Frontend Structure Rules

### Structure Decision Hierarchy

When determining project structure for backend/frontend applications:

1. **User's Existing Structure** (if user wrote >60% of code)
   - Detect and document in CLAUDE.local.md
   - Preserve their organization patterns
   - Make minimal changes for compliance

2. **concept.md Specifications** (if defined)
   - Follow explicit structure guidelines
   - Example: "Use src/ for all source files"
   - Overrides BONSAI defaults

3. **BONSAI Minimal Structure** (default)
   - Start with single files
   - Split only when complexity demands
   - Feature-based, not type-based organization

### Structure Detection & Persistence

**CRITICAL**: Once a structure decision is recorded in CLAUDE.local.md, it MUST NOT be changed unless:
- No structure decision exists yet in CLAUDE.local.md
- User explicitly requests: "Change to BONSAI structure" or "Use structure from concept.md"

On first backend/frontend operation:
1. **Check CLAUDE.local.md FIRST** - If structure decision exists, use it
2. If no decision recorded:
   - Scan for existing structure patterns
   - Check concept.md for structure specifications  
   - Make decision based on hierarchy above
3. Document decision in CLAUDE.local.md:

```markdown
## Project Structure Decision
### Date: 2024-01-15
### Structure Type: [User Custom|concept.md|BONSAI]
### LOCKED: Do not change unless user explicitly requests

### Detected Pattern:
- Backend: [description]
- Frontend: [description]  
- Reasoning: [why this choice]

### Structure Rules:
- API endpoints: [location]
- Components: [location]
- Shared code: [location]
- Tests: [location]
```

### Environment Placement (BONSAI Style)

#### Single Technology Projects
```
project/
‚îú‚îÄ‚îÄ .venv/              # Python venv at root
‚îú‚îÄ‚îÄ node_modules/       # Node deps at root
‚îú‚îÄ‚îÄ main.py            # Or index.js
‚îî‚îÄ‚îÄ README.md
```

#### Full-Stack Projects - Progressive Evolution

**Stage 1: Both in Root (Start here)**
```
project/
‚îú‚îÄ‚îÄ .venv/              # Python backend env
‚îú‚îÄ‚îÄ node_modules/       # Frontend deps
‚îú‚îÄ‚îÄ backend.py          # Backend code
‚îú‚îÄ‚îÄ frontend.html       # Frontend code
‚îú‚îÄ‚îÄ package.json        # Frontend deps
‚îú‚îÄ‚îÄ pyproject.toml      # Backend deps
‚îî‚îÄ‚îÄ README.md
```

**Stage 2: Split When Needed (Only if conflicts)**
```
project/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ .venv/          # Python env
‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îî‚îÄ‚îÄ pyproject.toml
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ node_modules/   # Node deps
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

**Environment Rules**:
- Start with environments at project root
- Only move into subdirectories when actual conflicts occur
- Never create empty directory structures preemptively
- Document environment locations in CLAUDE.local.md

### BONSAI Default Structures

#### Progressive Backend Evolution (Python/FastAPI)
```
# Stage 1: Single file
main.py                 # Everything here

# Stage 2: Minimal split (>200 lines)
backend/
‚îú‚îÄ‚îÄ main.py            # Entry point & routes
‚îî‚îÄ‚îÄ models.py          # Data models

# Stage 3: Feature split (>500 lines)
backend/
‚îú‚îÄ‚îÄ main.py            # Entry point
‚îú‚îÄ‚îÄ api.py             # Routes/endpoints
‚îú‚îÄ‚îÄ models.py          # Data models
‚îî‚îÄ‚îÄ auth.py            # Only if auth complex
```

#### Progressive Frontend Evolution (React)
```
# Stage 1: Single file
index.html             # React inline

# Stage 2: Minimal split
frontend/
‚îú‚îÄ‚îÄ index.html  
‚îú‚îÄ‚îÄ app.js             # Extracted JS
‚îî‚îÄ‚îÄ styles.css         # Extracted CSS

# Stage 3: Component split (>3 components)
frontend/
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ App.jsx            # Main component
‚îú‚îÄ‚îÄ components/        # Feature components
‚îÇ   ‚îú‚îÄ‚îÄ Auth.jsx
‚îÇ   ‚îî‚îÄ‚îÄ Dashboard.jsx
‚îî‚îÄ‚îÄ api.js             # API calls
```

#### Full-Stack Progressive Evolution
```
# Stage 1: Two files (Start here!)
project/
‚îú‚îÄ‚îÄ backend.py         # Entire backend
‚îú‚îÄ‚îÄ frontend.html      # Entire frontend
‚îî‚îÄ‚îÄ README.md

# Stage 2: Static assets extracted
project/
‚îú‚îÄ‚îÄ backend.py  
‚îú‚îÄ‚îÄ index.html  
‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îú‚îÄ‚îÄ app.js
‚îÇ   ‚îî‚îÄ‚îÄ styles.css
‚îî‚îÄ‚îÄ README.md

# Stage 3: Backend/Frontend split (only when truly needed)
project/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ .venv/         # Moved from root
‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îî‚îÄ‚îÄ models.py
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ node_modules/  # Moved from root
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îî‚îÄ‚îÄ App.jsx
‚îî‚îÄ‚îÄ README.md
```

### Anti-Patterns to Avoid

‚ùå **Premature Folder Structure**
```
src/
‚îú‚îÄ‚îÄ controllers/
‚îú‚îÄ‚îÄ models/
‚îú‚îÄ‚îÄ views/
‚îú‚îÄ‚îÄ utils/
‚îú‚îÄ‚îÄ helpers/
‚îú‚îÄ‚îÄ middleware/
‚îú‚îÄ‚îÄ services/
‚îî‚îÄ‚îÄ repositories/
```
*Why bad*: Empty folders, single-file folders, over-organization

‚úÖ **BONSAI Approach**
```
api.py          # All endpoints here until it's too big
models.py       # All models here until it's too big
```

### When to Create Folders

Only create a folder when:
- You have 3+ files of similar purpose
- Files are clearly related by feature
- It improves code discovery
- It reduces naming conflicts

Examples:
- `auth_login.py`, `auth_register.py`, `auth_reset.py` ‚Üí `auth/`
- `UserModel.js`, `PostModel.js`, `CommentModel.js` ‚Üí `models/`

## Best Practices & Preferred Tools

### Python
- **Package Manager**: uv (replaces pip, pipenv, poetry)
- **Linter/Formatter**: ruff (replaces black, isort, flake8)
- **Type Checker**: pyright (only when needed)
- **Testing**: pytest + hypothesis (when complexity justifies)
- **Data Validation**: pydantic (type-safe data models and validation)
- **Data Processing**: pandas (for data manipulation and analysis)
- **CLI Enhancement**: rich (beautiful terminal output, progress bars, logging)

#### Ruff Philosophy
Ruff should catch real errors and promote clean code, not enforce arbitrary restrictions:
- ‚úÖ Catch actual bugs (undefined names, syntax errors)
- ‚úÖ Promote cross-platform code (pathlib usage)
- ‚úÖ Encourage modern Python (pyupgrade)
- ‚ùå Don't enforce arbitrary limits (line length, arg count)
- ‚ùå Don't require documentation everywhere
- ‚ùå Don't be dogmatic about style preferences

#### Minimal Ruff Configuration (pyproject.toml):
```toml
[tool.ruff]
line-length = 120
target-version = "py312"

[tool.ruff.lint]
select = [
    "E",  # pycodestyle errors
    "W",  # pycodestyle warnings
    "F",  # pyflakes
    "UP", # pyupgrade
    "B",  # flake8-bugbear
    "C4", # flake8-comprehensions
    "PIE", # flake8-pie
    "PTH", # flake8-use-pathlib
]

ignore = [
    "E501", # line too long (let formatter handle)
    "B008", # do not perform function calls in argument defaults
    "C901", # too complex
    "B904", # raise without from in except
]

[tool.ruff.format]
quote-style = "double"
indent-style = "space"
skip-magic-trailing-comma = false
line-ending = "auto"

[tool.ruff.lint.per-file-ignores]
"tests/*" = ["F401", "F811"]  # Allow unused imports in tests

[tool.pyright]
include = ["src"]
exclude = ["**/node_modules", "**/__pycache__"]
reportMissingImports = true
reportMissingTypeStubs = false
pythonVersion = "3.12"
typeCheckingMode = "basic"
useLibraryCodeForTypes = true
```

### JavaScript/React
- **Package Manager**: yarn (or pnpm for better performance)
- **Build Tool**: vite (always - not "when needed")
- **Framework**: React 18+ with TypeScript
- **CSS Framework**: Tailwind CSS v4+ (required for BONSAI design system)
- **State Management**: zustand (simpler than Redux)
- **Server State**: @tanstack/react-query
- **Formatter**: prettier
- **Linter**: eslint (minimal rules)
- **Testing**: vitest + @testing-library/react
- **Scripts**: Use `node scripts/build.js` not shell scripts

#### Vite Configuration (minimal):
```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    port: 3000,
    proxy: {
      '/api': 'http://localhost:8000'
    }
  }
})
```

#### TypeScript Configuration (when needed):
```json
// tsconfig.json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["ES2020", "DOM"],
    "module": "ESNext",
    "jsx": "react-jsx",
    "strict": true,
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "skipLibCheck": true
  },
  "include": ["src"]
}
```

#### Prettier Configuration (.prettierrc):
```json
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 2,
  "printWidth": 100,
  "trailingComma": "es5"
}
```

#### ESLint Configuration (minimal):
```json
// .eslintrc.json
{
  "extends": [
    "eslint:recommended",
    "@typescript-eslint/recommended",
    "plugin:react/recommended",
    "plugin:react-hooks/recommended"
  ],
  "rules": {
    "react/react-in-jsx-scope": "off",
    "@typescript-eslint/no-unused-vars": ["error", { "argsIgnorePattern": "^_" }]
  }
}
```

### Python Tool Examples

#### Pydantic Minimal Usage
```python
# When you need data validation beyond basic types
from pydantic import BaseModel, Field
from typing import Optional

class UserConfig(BaseModel):
    name: str = Field(min_length=1, max_length=50)
    email: str = Field(pattern=r'^[^@]+@[^@]+\.[^@]+$')
    age: Optional[int] = Field(None, ge=0, le=150)

    class Config:
        # Automatic validation from dict/JSON
        extra = "forbid"  # Reject unknown fields

# Usage
config = UserConfig.model_validate({
    "name": "John",
    "email": "john@example.com",
    "age": 30
})
```

#### Rich Minimal Usage (BONSAI-Aligned)
```python
# BONSAI-styled CLI output using rich
from rich.console import Console
from rich.progress import Progress, SpinnerColumn, TextColumn
from rich.table import Table
from rich.text import Text
import time

console = Console()

# BONSAI color palette (consistent with design system)
BONSAI_COLORS = {
    'green_primary': '#7c9885',    # Success, growth
    'blue_primary': '#82a4c7',     # Information, links
    'yellow_primary': '#c7a882',   # Warning, warmth
    'red_primary': '#c78289',      # Error, attention
    'purple_primary': '#9882c7',   # Special features
    'text_primary': '#e6e8eb',     # Main content
    'text_muted': '#8b92a5',       # Secondary text
}

# Zen-like messaging (no aggressive styling)
console.print("‚Üí Processing data...", style=BONSAI_COLORS['info'])
console.print("‚úó Error occurred", style=BONSAI_COLORS['error'])  # No "bold"
console.print("‚úì Operation complete", style=BONSAI_COLORS['success'])

# Minimal progress indicator
with Progress(
    SpinnerColumn(),
    TextColumn("[progress.description]{task.description}"),
    transient=True,  # Disappears when done (minimal)
) as progress:
    task = progress.add_task("Processing...", total=100)
    for i in range(100):
        progress.update(task, advance=1)
        time.sleep(0.01)

# BONSAI-styled table (minimal, readable)
table = Table(title="Results", show_header=True, header_style=BONSAI_COLORS['primary'])
table.add_column("Task", style=BONSAI_COLORS['primary'], no_wrap=True)
table.add_column("Status", style=BONSAI_COLORS['muted'])

# Use BONSAI symbols and muted colors
table.add_row("Data processing", Text("‚úì Complete", style=BONSAI_COLORS['success']))
table.add_row("Validation", Text("‚Üí Running", style=BONSAI_COLORS['info']))
table.add_row("Cleanup", Text("‚è≥ Pending", style=BONSAI_COLORS['muted']))

console.print(table)
```

### Framework-Specific Minimal Structures

#### FastAPI Minimal
```python
# main.py - Everything in one file until complexity demands split
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
def read_root():
    return {"message": "Hello World"}

# Add more endpoints here
# Split to api.py when >10 endpoints
# Split to models.py when >3 models
```

#### Express Minimal
```javascript
// server.js - Everything in one file
const express = require('express')
const app = express()

app.get('/', (req, res) => {
  res.json({ message: 'Hello World' })
})

app.listen(3000)
// Split when file exceeds 200 lines
```

#### React Minimal
```html
<!-- index.html - Start with everything inline -->
<!DOCTYPE html>
<html>
<head>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script>
        function App() {
            return React.createElement('h1', null, 'Hello World')
        }
        ReactDOM.render(React.createElement(App), document.getElementById('root'))
    </script>
</body>
</html>
<!-- Extract to app.js when logic exceeds 50 lines -->
```

### Tool Introduction Triggers

#### **pytest**: Add when ANY of these complexity indicators are met:
- **Mathematical Logic**: Functions with calculations, formulas, or mathematical operations
- **Validation Logic**: Data validation, type checking, or error handling beyond simple checks
- **Class Methods**: Any class with 3+ methods or complex state management
- **Combinatorial Functions**: Functions generating combinations, permutations, or nested iterations
- **File I/O Operations**: JSON serialization, file loading, or data persistence
- **Edge Cases**: Functions that need testing with boundary conditions or invalid inputs
- **Configuration Logic**: Parameter configuration, sweep generation, or complex object creation

#### **pydantic**: Add when ANY of these data handling scenarios arise:
- **API Integration**: External APIs requiring structured data validation
- **Configuration Management**: Complex settings, environment variables, or config files
- **Data Models**: Classes representing business entities with validation rules
- **Type Safety**: Need runtime validation of data types beyond static type hints
- **Serialization**: JSON/dict conversion with automatic validation
- **Input Validation**: User input, file parsing, or data transformation pipelines

#### **rich**: Add when building CLI applications that need:
- **Progress Indicators**: Long-running operations, file processing, data migration
- **Structured Logging**: Better than print() for debugging and user feedback
- **Error Display**: Beautiful tracebacks and error formatting
- **Tables/Lists**: Displaying data in organized, readable formats
- **Interactive Elements**: Prompts, confirmations, or status displays
- **Professional CLI**: When your tool will be used by others or in production

#### **hypothesis**: Property-based testing for complex edge cases
- Add when pytest tests become repetitive for testing ranges
- Useful for testing mathematical functions with many possible inputs  
- **Trigger**: When you find yourself writing >5 similar test cases for the same function

#### **pre-commit**: Add when ANY of these collaboration indicators are met:
- **Repository has 4+ core files** (excluding configs like .gitignore, pyproject.toml)
- **Multiple contributors** working on the project
- **Production deployment** planned or active
- **Complex formatting rules** that must be enforced consistently
- **Security-sensitive code** that needs automatic scanning

#### **type hints**: Function used in 3+ places or has 3+ parameters

#### **docker**: Deployment or complex dependencies
#### **CI/CD**: Automated deployment or team collaboration

### Tool Addition Protocol
When adding new tools:
1. **Check Don'ts section** - User may have specified alternatives
2. **Start minimal** - Only essential configuration
3. **Document trigger** - Why was this tool added now?
4. **Update .gitignore** - Add tool-specific ignore patterns
5. **Record in CLAUDE.local.md** - Tool-specific environment behaviors

### Database
- **SQL Database**: SQLite (file-based, zero-config, cross-platform)
- **NoSQL/Document**: Start with JSON files, move to SQLite when relationships needed
- **Data Analysis**: Use pandas for data manipulation before/after database operations

### Cross-Platform Considerations
- **Python**: Always use `pathlib.Path` over string concatenation
- **Node.js**: Use `path.join()` and avoid shell-specific commands in npm scripts
- **Scripts**: Prefer Node.js scripts over shell scripts for cross-platform compatibility
- **Environment**: Use `.env` files with consistent variable names across platforms
- **Database**: SQLite works identically across all platforms

### BONSAI Git Commit Template

**MANDATORY for all "c/p" commands** (including "Bypass: c/p"):

```
# üå± BONSAI Commit Template
#
# Format: <type>: <description>
#
# Types (choose one):
#   feat     - New feature or functionality
#   fix      - Bug fix or correction
#   refactor - Code improvement without changing functionality
#   docs     - Documentation changes
#   style    - Code style/formatting (no logic changes)
#   test     - Adding or updating tests
#   chore    - Maintenance tasks, dependencies, tooling
#   perf     - Performance improvements
#   clean    - Code cleanup, removing unused code
#
# Guidelines:
# - Use present tense, imperative mood ("Add feature" not "Added feature")
# - Keep subject line under 50 characters
# - Separate subject from body with blank line
# - Use body to explain what and why, not how
# - Reference issues/PRs when relevant (#123)
#
# Example:
# feat: Add user authentication with JWT tokens
#
# Implements secure login/logout functionality using JSON Web Tokens.
# Includes password hashing and session management.
#
# Closes #45
#
# ü§ñ Generated with [Claude Code](https://claude.ai/code)
#
# Co-Authored-By: Claude <noreply@anthropic.com>
```

**Usage Rules:**
- **Always** follow this template format for commit messages
- **Choose appropriate type** from the provided list
- **Include Claude Code attribution** footer in all commits
- **Apply consistently** whether in BONSAI workflow or bypass mode

## Design Philosophy

**BONSAI design extends minimalism to the visual realm** - every pixel serves a purpose, every color conveys meaning, every interaction feels intentional.

### Core Design Principles

**Purposeful Aesthetics**: Like BONSAI code that does exactly what's needed, BONSAI interfaces show exactly what users need to see. No decorative elements, no visual noise - only purposeful design that guides attention naturally.

**Dark Zen Approach**: Eye-friendly dark themes that reduce fatigue and energy consumption. Interfaces should feel like meditation in motion - calming, focused, and effortless to use.

**Progressive Disclosure**: Start with essential information, reveal complexity only when needed. Like growing a bonsai tree, interfaces should unfold their capabilities gradually.

### BONSAI Color System

The BONSAI color palette provides a sophisticated, muted aesthetic designed for minimal interfaces and eye comfort. These colors apply to:
- **User Interfaces** (web, desktop, mobile)
- **Command Line Interfaces** and terminal output
- **Program logs and console output**
- **Data visualizations and charts**
- **Documentation and reports**

#### Background Colors
```css
--BONSAI_background_deep: #0a0e14;        /* Main application background, deepest layer */
--BONSAI_background_primary: #151922;     /* Primary containers, cards, panels */
--BONSAI_background_secondary: #1e242e;   /* Secondary containers, nested elements */
--BONSAI_background_elevated: #232933;    /* Elevated surfaces, dropdowns, tooltips */
--BONSAI_background_overlay: #2a3040;     /* Modal overlays, highest elevation */
```

#### Text Colors
```css
--BONSAI_text_primary: #e6e8eb;       /* Main headings, primary content */
--BONSAI_text_secondary: #b8bcc8;     /* Body text, secondary information */
--BONSAI_text_muted: #8b92a5;         /* Labels, captions, metadata */
--BONSAI_text_disabled: #6b7280;      /* Disabled text, inactive elements */
--BONSAI_text_inverted: #0a0e14;      /* Text on light backgrounds, buttons */
```

#### Border Colors
```css
--BONSAI_border_subtle: #2d3441;      /* Gentle separations, zen garden style */
--BONSAI_border_primary: #3d4455;     /* Standard borders */
--BONSAI_border_accent: #4a5568;      /* Hover states, focus indicators */
--BONSAI_border_strong: #5a6578;      /* Strong emphasis, active states */
```

#### Core Accent Colors

**Green Family (Nature, Growth, Success)**
```css
--BONSAI_green_primary: #7c9885;      /* Primary brand color, success states */
--BONSAI_green_secondary: #9db4a6;    /* Hover states, lighter accents */
--BONSAI_green_tertiary: #a8c0b1;     /* Subtle backgrounds, very light accents */
--BONSAI_green_muted: #677a70;        /* Darker variant, borders, inactive states */
--BONSAI_green_glow: rgba(124, 152, 133, 0.15); /* Alpha overlays */
```

**Red Family (Attention, Errors)**
```css
--BONSAI_red_primary: #c78289;        /* Error states, destructive actions */
--BONSAI_red_secondary: #d4999f;      /* Hover states, lighter error backgrounds */
--BONSAI_red_tertiary: #dfa8ad;       /* Very subtle error backgrounds */
--BONSAI_red_muted: #a56b71;          /* Darker variant, borders */
--BONSAI_red_glow: rgba(199, 130, 137, 0.15); /* Alpha overlays */
```

**Blue Family (Information, Links)**
```css
--BONSAI_blue_primary: #82a4c7;       /* Information states, links, cool accents */
--BONSAI_blue_secondary: #9bb5d4;     /* Hover states, lighter info backgrounds */
--BONSAI_blue_tertiary: #adc2db;      /* Very subtle info backgrounds */
--BONSAI_blue_muted: #6b8aa5;         /* Darker variant, borders */
--BONSAI_blue_glow: rgba(130, 164, 199, 0.15); /* Alpha overlays */
```

**Yellow Family (Warning, Warmth)**
```css
--BONSAI_yellow_primary: #c7a882;     /* Warning states, warm accents */
--BONSAI_yellow_secondary: #d4b99b;   /* Hover states, lighter warning backgrounds */
--BONSAI_yellow_tertiary: #dbc5ad;    /* Very subtle warning backgrounds */
--BONSAI_yellow_muted: #a5906b;       /* Darker variant, borders */
--BONSAI_yellow_glow: rgba(199, 168, 130, 0.15); /* Alpha overlays */
```

#### Extended Palette
```css
--BONSAI_purple_primary: #9882c7;     /* Creative elements, special features */
--BONSAI_orange_primary: #c7975c;     /* Notifications, energy, calls-to-action */
--BONSAI_teal_primary: #5cc7a8;       /* Fresh, modern accents, progress */
```

#### Semantic Aliases
```css
--BONSAI_success: var(--BONSAI_green_primary);
--BONSAI_success_bg: var(--BONSAI_green_glow);
--BONSAI_warning: var(--BONSAI_yellow_primary);
--BONSAI_warning_bg: var(--BONSAI_yellow_glow);
--BONSAI_error: var(--BONSAI_red_primary);
--BONSAI_error_bg: var(--BONSAI_red_glow);
--BONSAI_info: var(--BONSAI_blue_primary);
--BONSAI_info_bg: var(--BONSAI_blue_glow);
```

### Dark Zen UI Principles

**Visual Harmony**
- **Color Temperature**: Warm grays and sage greens create calm, meditative interfaces
- **Breathing Space**: Generous whitespace (2rem-3rem sections) prevents visual overwhelm
- **Gentle Transitions**: 0.3s ease transitions feel organic, not mechanical
- **Purposeful Glow**: Subtle shadows and glows guide attention naturally

**Unique Elements**
- **Quantum Metrics**: Status indicators with soft glows show system health
- **Organic Charts**: Data visualization that feels alive and responsive
- **Zen Controls**: Toggle switches and buttons that feel meditative to interact with
- **Terminal Zen**: Code display elevated beyond basic terminal styling

**Navigation Philosophy**
- **Zen Garden Separation**: Borders appear through light, not heavy lines
- **Progressive Disclosure**: Show essential, reveal advanced on interaction
- **Natural Grouping**: Related functions flow together like garden paths
- **Peaceful Hierarchy**: No shouting colors or aggressive visual weight

### Typography Guidelines

**Font Selection**
- **Primary**: Quicksand (300-600 weights) - unique yet readable, modern minimalism
- **Code**: JetBrains Mono (300-500 weights) - optimized for developer comfort
- **Line Height**: 1.6-1.7 for comfortable reading
- **Letter Spacing**: Subtle (0.02em-0.1em) for breathing room

**Hierarchy**
- **Headings**: font-weight: 300-500 (never bold unless necessary)
- **Body**: font-weight: 400, comfortable contrast
- **Captions**: font-weight: 300, muted colors
- **Code**: monospace, slightly smaller than body text

### Layout Principles

**Spacing System**
- **Base Unit**: 8px
- **Common Increments**: 8, 16, 24, 32, 48, 64px
- **Container Padding**: 2rem (32px) minimum
- **Section Gaps**: 3rem (48px) for clear separation

**Component Design**
- **Border Radius**: 6-16px for modern softness
- **Card Elevation**: Subtle 1px borders, minimal shadows
- **Interactive States**: Transform: translateY(-1px) for lift effect
- **Focus Indicators**: BONSAI_green_primary with soft glow

### Interface Design Examples

The following design examples demonstrate BONSAI principles in action. **These are inspirational templates only** - your actual implementation may be:
- **Any technology**: HTML, React, Vue, Qt, Flutter, SwiftUI, etc.
- **Any layout**: Single page, multi-page, desktop app, mobile app
- **Any navigation**: Sidebar, top nav, tabs, drawer, etc.
- **Any components**: The specific buttons, forms, and widgets depend on your project needs

**The examples show the aesthetic and principles, not prescriptive layouts.**

#### Example 1: Quantum Dashboard
**Concept**: Real-time system monitoring with crystalline clarity
- **Metric Cards**: Elevated surfaces with subtle status indicators
- **Zen Terminal**: Mac-style window chrome with color-coded logs
- **Breathing Layout**: Generous spacing prevents visual stress
- **Status Indicators**: Soft glowing dots instead of harsh icons

#### Example 2: Organic Data Flow
**Concept**: Living data visualization that breathes with your metrics
- **Organic Charts**: Data bars that feel alive and responsive
- **Pill Controls**: Rounded selection buttons with smooth transitions
- **Gradient Overlays**: Subtle visual interest without distraction
- **Hover Interactions**: Gentle lift effects and soft glows

#### Example 3: Zen Control Center
**Concept**: Intuitive system controls that feel like meditation in motion
- **Toggle Switches**: Smooth, satisfying interactions
- **Grouped Sections**: Related controls flow together naturally
- **Descriptive Labels**: Clear purpose for every setting
- **Action Buttons**: Primary/secondary hierarchy with gentle elevation

#### CLI and Program Output Styling

**Terminal Color Usage**
```bash
# Success messages - use BONSAI_green_primary
echo -e "\033[38;2;124;152;133m‚úì Operation completed successfully\033[0m"

# Warning messages - use BONSAI_yellow_primary  
echo -e "\033[38;2;199;168;130m‚ö† Warning: High memory usage detected\033[0m"

# Error messages - use BONSAI_red_primary
echo -e "\033[38;2;199;130;137m‚úó Error: Connection failed\033[0m"

# Info messages - use BONSAI_blue_primary
echo -e "\033[38;2;130;164;199m‚Üí Processing request...\033[0m"

# Muted text - use BONSAI_text_muted
echo -e "\033[38;2;139;146;165m[2025-06-11 14:32:15]\033[0m"
```

**Log File Formatting**
- Use BONSAI colors for log levels
- Maintain readability in both terminals and log viewers
- Apply consistent timestamp formatting
- Use symbols (‚úì ‚ö† ‚úó ‚Üí) for quick visual scanning

### BONSAI Matplotlib Theme

For Python data visualization projects, use the BONSAI matplotlib theme to create charts that align with the design philosophy.

#### Quick Setup

**Option 1: Direct Style Application**
```python
import matplotlib.pyplot as plt
import matplotlib as mpl

# BONSAI matplotlib configuration
BONSAI_STYLE = {
    # Figure and background
    'figure.facecolor': '#0a0e14',
    'figure.edgecolor': '#0a0e14',
    'figure.figsize': [10, 6],
    'figure.dpi': 100,
    'savefig.facecolor': '#0a0e14',
    'savefig.edgecolor': '#0a0e14',
    'savefig.dpi': 300,

    # Axes styling
    'axes.facecolor': '#151922',
    'axes.edgecolor': '#2d3441',
    'axes.linewidth': 1.0,
    'axes.grid': True,
    'axes.axisbelow': True,
    'axes.labelcolor': '#e6e8eb',
    'axes.labelsize': 11,
    'axes.titlesize': 14,
    'axes.titleweight': 'normal',
    'axes.titlecolor': '#e6e8eb',
    'axes.spines.left': True,
    'axes.spines.bottom': True,
    'axes.spines.top': False,
    'axes.spines.right': False,

    # Grid styling
    'grid.color': '#4a5568',
    'grid.linestyle': '-',
    'grid.linewidth': 0.8,
    'grid.alpha': 0.8,

    # Ticks
    'xtick.color': '#e6e8eb',
    'xtick.labelsize': 10,
    'xtick.direction': 'out',
    'xtick.major.size': 5,
    'xtick.minor.size': 3,
    'ytick.color': '#e6e8eb',
    'ytick.labelsize': 10,
    'ytick.direction': 'out',
    'ytick.major.size': 5,
    'ytick.minor.size': 3,

    # Legend
    'legend.facecolor': '#1e242e',
    'legend.edgecolor': '#2d3441',
    'legend.fontsize': 9,
    'legend.framealpha': 0.95,
    'legend.fancybox': True,
    'legend.shadow': False,

    # Lines and markers
    'lines.linewidth': 2.0,
    'lines.markersize': 6,
    'lines.markeredgewidth': 0,

    # Font settings
    'font.family': ['DejaVu Sans', 'sans-serif'],
    'font.size': 10,
    'font.weight': 'normal',

    # Text
    'text.color': '#e6e8eb',

    # Patch (bars, areas, etc.)
    'patch.linewidth': 0.5,
    'patch.facecolor': '#7c9885',
    'patch.edgecolor': '#677a70',
    'patch.force_edgecolor': False,
}

# Apply the style
plt.rcParams.update(BONSAI_STYLE)
```

**Option 2: Style File (.mplstyle)**
Save as `bonsai.mplstyle` in your project or matplotlib config directory:
```
# BONSAI matplotlib style
figure.facecolor: 0a0e14
figure.edgecolor: 0a0e14
figure.figsize: 10, 6
figure.dpi: 100
savefig.facecolor: 0a0e14
savefig.edgecolor: 0a0e14
savefig.dpi: 300

axes.facecolor: 151922
axes.edgecolor: 2d3441
axes.linewidth: 1.0
axes.grid: True
axes.axisbelow: True
axes.labelcolor: e6e8eb
axes.labelsize: 11
axes.titlesize: 14
axes.titleweight: normal
axes.titlecolor: e6e8eb
axes.spines.left: True
axes.spines.bottom: True
axes.spines.top: False
axes.spines.right: False

grid.color: 4a5568
grid.linestyle: -
grid.linewidth: 0.8
grid.alpha: 0.8

xtick.color: e6e8eb
xtick.labelsize: 10
xtick.direction: out
xtick.major.size: 5
xtick.minor.size: 3
ytick.color: e6e8eb
ytick.labelsize: 10
ytick.direction: out
ytick.major.size: 5
ytick.minor.size: 3

legend.facecolor: 1e242e
legend.edgecolor: 2d3441
legend.fontsize: 9
legend.framealpha: 0.95
legend.fancybox: True
legend.shadow: False

lines.linewidth: 2.0
lines.markersize: 6
lines.markeredgewidth: 0

font.family: DejaVu Sans, sans-serif
font.size: 10
font.weight: normal

text.color: e6e8eb

patch.linewidth: 0.5
patch.facecolor: 7c9885
patch.edgecolor: 677a70
patch.force_edgecolor: False
```

Then use: `plt.style.use('bonsai')`

#### BONSAI Color Palettes

```python
# BONSAI color palettes for matplotlib
BONSAI_COLORS = {
    # Primary accent colors
    'green_primary': '#7c9885',
    'red_primary': '#c78289',
    'blue_primary': '#82a4c7',
    'yellow_primary': '#c7a882',
    'purple_primary': '#9882c7',
    'orange_primary': '#c7975c',
    'teal_primary': '#5cc7a8',

    # Secondary variants
    'green_secondary': '#9db4a6',
    'red_secondary': '#d4999f',
    'blue_secondary': '#9bb5d4',
    'yellow_secondary': '#d4b99b',

    # Muted variants
    'green_muted': '#677a70',
    'red_muted': '#a56b71',
    'blue_muted': '#6b8aa5',
    'yellow_muted': '#a5906b',

    # Text colors
    'text_primary': '#e6e8eb',
    'text_secondary': '#b8bcc8',
    'text_muted': '#8b92a5',
}

# Create color lists for different chart types
BONSAI_QUALITATIVE = [
    '#7c9885',  # green_primary
    '#82a4c7',  # blue_primary
    '#c7a882',  # yellow_primary
    '#c78289',  # red_primary
    '#9882c7',  # purple_primary
    '#c7975c',  # orange_primary
    '#5cc7a8',  # teal_primary
]

BONSAI_SEQUENTIAL_GREEN = [
    '#677a70',  # green_muted
    '#7c9885',  # green_primary
    '#9db4a6',  # green_secondary
    '#a8c0b1',  # green_tertiary
]

BONSAI_DIVERGING = [
    '#c78289',  # red_primary
    '#d4999f',  # red_secondary
    '#8b92a5',  # text_muted (neutral)
    '#9bb5d4',  # blue_secondary
    '#82a4c7',  # blue_primary
]

# Register custom colormaps
from matplotlib.colors import LinearSegmentedColormap

# BONSAI Green colormap
bonsai_green_cmap = LinearSegmentedColormap.from_list(
    'bonsai_green', BONSAI_SEQUENTIAL_GREEN, N=256
)
plt.register_cmap('bonsai_green', bonsai_green_cmap)

# BONSAI Diverging colormap
bonsai_div_cmap = LinearSegmentedColormap.from_list(
    'bonsai_diverging', BONSAI_DIVERGING, N=256
)
plt.register_cmap('bonsai_diverging', bonsai_div_cmap)
```

#### Usage Examples

**Basic Line Plot**
```python
import numpy as np
import matplotlib.pyplot as plt

# Apply BONSAI style
plt.rcParams.update(BONSAI_STYLE)

# Sample data
x = np.linspace(0, 10, 100)
y1 = np.sin(x)
y2 = np.cos(x)

# Create plot
fig, ax = plt.subplots(figsize=(10, 6))
ax.plot(x, y1, color=BONSAI_COLORS['green_primary'], label='sin(x)', linewidth=2)
ax.plot(x, y2, color=BONSAI_COLORS['blue_primary'], label='cos(x)', linewidth=2)

ax.set_title('BONSAI Style Line Plot', fontsize=16, pad=20)
ax.set_xlabel('X Values')
ax.set_ylabel('Y Values')
ax.legend()

plt.tight_layout()
plt.show()
```

**Multi-series Bar Chart**
```python
# Sample data
categories = ['Category A', 'Category B', 'Category C', 'Category D']
values1 = [23, 45, 56, 78]
values2 = [65, 43, 32, 56]

x = np.arange(len(categories))
width = 0.35

fig, ax = plt.subplots(figsize=(10, 6))

# Use BONSAI colors
bars1 = ax.bar(x - width/2, values1, width,
               color=BONSAI_COLORS['green_primary'],
               label='Series 1', alpha=0.9)
bars2 = ax.bar(x + width/2, values2, width,
               color=BONSAI_COLORS['blue_primary'],
               label='Series 2', alpha=0.9)

ax.set_title('BONSAI Style Bar Chart', fontsize=16, pad=20)
ax.set_xlabel('Categories')
ax.set_ylabel('Values')
ax.set_xticks(x)
ax.set_xticklabels(categories)
ax.legend()

plt.tight_layout()
plt.show()
```

**Heatmap with Custom Colormap**
```python
import seaborn as sns

# Sample correlation matrix
data = np.random.randn(10, 10)
corr_matrix = np.corrcoef(data)

fig, ax = plt.subplots(figsize=(8, 8))

# Use BONSAI diverging colormap
heatmap = ax.imshow(corr_matrix, cmap='bonsai_diverging', aspect='auto')
ax.set_title('BONSAI Style Heatmap', fontsize=16, pad=20)

# Add colorbar
cbar = plt.colorbar(heatmap, ax=ax)
cbar.ax.yaxis.set_tick_params(color=BONSAI_COLORS['text_secondary'])

plt.tight_layout()
plt.show()
```

**Subplot Dashboard**
```python
# Create a dashboard-style layout
fig = plt.figure(figsize=(15, 10))
fig.suptitle('BONSAI Data Dashboard', fontsize=20, y=0.98)

# Line plot
ax1 = plt.subplot(2, 2, 1)
x = np.linspace(0, 10, 50)
y = np.sin(x) + np.random.normal(0, 0.1, 50)
ax1.plot(x, y, color=BONSAI_COLORS['green_primary'], linewidth=2, alpha=0.8)
ax1.fill_between(x, y, alpha=0.3, color=BONSAI_COLORS['green_primary'])
ax1.set_title('Time Series Data')
ax1.set_ylabel('Values')

# Bar chart
ax2 = plt.subplot(2, 2, 2)
categories = ['A', 'B', 'C', 'D', 'E']
values = [23, 45, 56, 78, 32]
bars = ax2.bar(categories, values, color=BONSAI_QUALITATIVE[:len(categories)])
ax2.set_title('Category Distribution')
ax2.set_ylabel('Count')

# Scatter plot
ax3 = plt.subplot(2, 2, 3)
x_scatter = np.random.randn(100)
y_scatter = x_scatter + np.random.randn(100) * 0.5
scatter = ax3.scatter(x_scatter, y_scatter,
                     c=y_scatter, cmap='bonsai_green',
                     alpha=0.7, s=50)
ax3.set_title('Correlation Analysis')
ax3.set_xlabel('Variable X')
ax3.set_ylabel('Variable Y')

# Pie chart with BONSAI colors
ax4 = plt.subplot(2, 2, 4)
sizes = [30, 25, 20, 15, 10]
labels = ['Segment 1', 'Segment 2', 'Segment 3', 'Segment 4', 'Segment 5']
wedges, texts, autotexts = ax4.pie(sizes, labels=labels, autopct='%1.1f%%',
                                  colors=BONSAI_QUALITATIVE[:len(sizes)],
                                  textprops={'color': BONSAI_COLORS['text_primary']})
ax4.set_title('Market Share')

plt.tight_layout(rect=[0, 0.03, 1, 0.95])
plt.show()
```

#### Utility Functions

```python
def apply_bonsai_style():
    """Quick function to apply BONSAI styling to matplotlib."""
    plt.rcParams.update(BONSAI_STYLE)

def bonsai_color(name):
    """Get BONSAI color by name."""
    return BONSAI_COLORS.get(name, BONSAI_COLORS['green_primary'])

def set_bonsai_palette(ax, palette_type='qualitative'):
    """Set color cycle for axes using BONSAI colors."""
    if palette_type == 'qualitative':
        ax.set_prop_cycle(color=BONSAI_QUALITATIVE)
    elif palette_type == 'green':
        ax.set_prop_cycle(color=BONSAI_SEQUENTIAL_GREEN)
    elif palette_type == 'diverging':
        ax.set_prop_cycle(color=BONSAI_DIVERGING)

def save_bonsai_plot(filename, dpi=300, bbox_inches='tight',
                     facecolor='#0a0e14', edgecolor='none'):
    """Save plot with BONSAI styling optimized for dark backgrounds."""
    plt.savefig(filename, dpi=dpi, bbox_inches=bbox_inches,
                facecolor=facecolor, edgecolor=edgecolor)

# Example usage
def create_bonsai_figure(figsize=(10, 6)):
    """Create a figure with BONSAI styling applied."""
    apply_bonsai_style()
    fig, ax = plt.subplots(figsize=figsize)
    set_bonsai_palette(ax)
    return fig, ax
```

#### Integration Example

```python
# Complete example: BONSAI-styled analysis report
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# Apply BONSAI theme
apply_bonsai_style()

# Sample data
np.random.seed(42)
dates = pd.date_range('2024-01-01', periods=100, freq='D')
values = np.cumsum(np.random.randn(100)) + 100
categories = ['Product A', 'Product B', 'Product C', 'Product D']
cat_values = np.random.randint(20, 100, len(categories))

# Create comprehensive report
fig = plt.figure(figsize=(16, 12))
fig.suptitle('Monthly Performance Report',
             fontsize=24, fontweight='normal', y=0.95)

# Main time series (takes up top half)
ax1 = plt.subplot(2, 2, (1, 2))
ax1.plot(dates, values, color=BONSAI_COLORS['green_primary'],
         linewidth=2.5, alpha=0.9)
ax1.fill_between(dates, values, alpha=0.2,
                color=BONSAI_COLORS['green_primary'])
ax1.set_title('Performance Trend Over Time', fontsize=16, pad=15)
ax1.set_ylabel('Performance Metric')
ax1.grid(True, alpha=0.3)

# Category breakdown
ax2 = plt.subplot(2, 2, 3)
bars = ax2.bar(categories, cat_values,
               color=BONSAI_QUALITATIVE[:len(categories)], alpha=0.9)
ax2.set_title('Category Performance', fontsize=16, pad=15)
ax2.set_ylabel('Value')
ax2.tick_params(axis='x', rotation=45)

# Distribution analysis
ax3 = plt.subplot(2, 2, 4)
hist_data = np.random.normal(50, 15, 1000)
n, bins, patches = ax3.hist(hist_data, bins=20,
                           color=BONSAI_COLORS['blue_primary'],
                           alpha=0.8, edgecolor='none')
ax3.set_title('Value Distribution', fontsize=16, pad=15)
ax3.set_xlabel('Value Range')
ax3.set_ylabel('Frequency')

plt.tight_layout(rect=[0, 0.03, 1, 0.92])

# Save with BONSAI styling
save_bonsai_plot('bonsai_report.png')
plt.show()
```

The BONSAI matplotlib theme ensures that all data visualizations maintain the same sophisticated, eye-friendly aesthetic as the rest of your project. The dark background reduces eye strain during long analysis sessions, while the carefully chosen accent colors provide clear visual hierarchy without being overwhelming.

### BONSAI Rich Console Integration

For Python projects using the Rich library for console output, apply the BONSAI color palette to maintain visual consistency between data visualizations and console logging.

#### Rich Console Setup

**BONSAI Color Palette for Rich**
```python
from rich.console import Console
from rich.logging import RichHandler
from rich.panel import Panel

# BONSAI color palette for Rich console output
BONSAI_COLORS = {
    'green_primary': '#7c9885',
    'red_primary': '#c78289',
    'blue_primary': '#82a4c7',
    'yellow_primary': '#c7a882',
    'purple_primary': '#9882c7',
    'orange_primary': '#c7975c',
    'teal_primary': '#5cc7a8',
    'text_primary': '#e6e8eb',
    'text_secondary': '#b8bcc8',
    'text_muted': '#8b92a5',
}
```

**Rich Logging Integration**
```python
# Apply BONSAI colors to Rich logging
console_handler = RichHandler(
    console=Console(),
    show_time=True,
    show_path=False,
    rich_tracebacks=True,
    markup=True,
    keywords=[
        f"[bold {BONSAI_COLORS['red_primary']}]ERROR[/]",
        f"[bold {BONSAI_COLORS['yellow_primary']}]WARNING[/]",
        f"[bold {BONSAI_COLORS['green_primary']}]INFO[/]",
        f"[bold {BONSAI_COLORS['blue_primary']}]DEBUG[/]",
        f"[bold {BONSAI_COLORS['purple_primary']}]SCPI[/]",
    ],
)
```

**Rich Panel Styling**
```python
# BONSAI-styled Rich panels
def create_bonsai_panel(content, title):
    return Panel(
        content,
        title=f"[bold {BONSAI_COLORS['green_primary']}]{title}[/bold {BONSAI_COLORS['green_primary']}]",
        border_style=BONSAI_COLORS['green_primary'],
    )

# Usage with BONSAI colors
console = Console()
session_info = ""
for key, value in data.items():
    session_info += f"[bold {BONSAI_COLORS['blue_primary']}]{key}:[/bold {BONSAI_COLORS['blue_primary']}] {value}\n"

panel = create_bonsai_panel(session_info.strip(), "System Information")
console.print(panel)
```

The BONSAI Rich console integration ensures that terminal output, logging messages, and panels use the same sophisticated color palette as data visualizations, creating a cohesive professional experience.

### Implementation Guidelines

**When Creating Interfaces**
1. **Start with content structure** - what information is essential?
2. **Apply BONSAI colors** - use the palette consistently
3. **Add generous spacing** - let the interface breathe
4. **Implement gentle interactions** - subtle hover effects and transitions
5. **Test in dark environments** - ensure comfort during extended use

**When Building CLIs**
1. **Use semantic colors** - green for success, red for errors, etc.
2. **Apply BONSAI Rich integration** - if using Rich library, apply BONSAI color palette
3. **Provide clear visual hierarchy** - timestamps, levels, messages
4. **Include progress indicators** - use BONSAI_green_primary for progress
5. **Make errors scannable** - use consistent symbols and colors

**When Designing Data Views**
1. **Prioritize readability** - data should be instantly comprehensible
2. **Use muted accent colors** - let the data be the hero
3. **Provide contextual information** - trends, comparisons, metadata
4. **Enable progressive disclosure** - summary ‚Üí details ‚Üí full data

**When Creating Data Visualizations**
1. **Apply BONSAI matplotlib theme** - consistent with UI design language
2. **Use semantic color palettes** - qualitative for categories, sequential for continuous data
3. **Maintain dark background aesthetic** - reduces eye strain during analysis
4. **Create publication-ready outputs** - professional quality for reports and presentations

### Remember

**BONSAI design is about intention, not restriction.** Every color choice, every spacing decision, every interaction should serve the user's goal. The interface should feel like a natural extension of the minimal, purposeful code underneath.

Like a carefully pruned bonsai tree, BONSAI interfaces reveal their beauty through what's left out as much as what's included.

The updated CLAUDE.md now provides developers with a complete visual language that matches the minimal, purposeful approach of BONSAI code. Whether building web apps, desktop software, mobile apps, command-line tools, or data analysis reports, teams can create interfaces that feel cohesive, professional, and meditative to use.

**BONSAI integration covers:**
- **Matplotlib**: Dark zen themes and sophisticated color palettes for data visualization
- **Rich Console**: BONSAI colors for logging, panels, and terminal output
- **UI Frameworks**: Design principles and color systems for web and desktop applications

## üå± BONSAI it! - Transform Existing Projects

**BONSAI it!** is a powerful transformation command that retrofits existing projects with BONSAI principles while minimizing disruption. It makes surgical changes to align with BONSAI philosophy.

### Command Activation

When user types exactly: **"BONSAI it!"**

### ‚ö†Ô∏è MANDATORY WARNING PROTOCOL

**BEFORE ANY EXECUTION**, display this warning and require DOUBLE confirmation:

```
üö® BONSAI TRANSFORMATION WARNING üö®

This process will modify your project to align with BONSAI principles:

POTENTIAL IMPACTS:
‚ö†Ô∏è CRITICAL CHANGES:
  ‚Ä¢ Tool replacements (e.g., black ‚Üí ruff, npm ‚Üí yarn)
  ‚Ä¢ Directory restructuring
  ‚Ä¢ Design system overhaul
  ‚Ä¢ Configuration file modifications

‚ö†Ô∏è RISKS:
  ‚Ä¢ Loss of functionality if incompatible patterns exist
  ‚Ä¢ Changed build processes
  ‚Ä¢ Different design language
  ‚Ä¢ Modified development workflows

‚ö†Ô∏è BACKUP RECOMMENDATION:
  ‚Ä¢ Commit all changes before proceeding
  ‚Ä¢ Ensure you have a recent backup
  ‚Ä¢ Consider testing on a branch first

Type "I understand and want to proceed" to continue.
```

After first confirmation:
```
‚ö†Ô∏è FINAL CONFIRMATION REQUIRED ‚ö†Ô∏è
This action cannot be automatically undone.
Type "BONSAI transform my project" to begin transformation.
```

### üö® CRITICAL TRANSFORMATION LOGIC üö®

**MANDATORY EXECUTION RULES - 100% COMPLIANCE REQUIRED:**

1. **concept.md exists + NO CODE**: Only modify concept.md, create NO files
2. **NO concept.md + CODE exists**: Only modify existing code, do NOT create concept.md  
3. **NO concept.md + NO CODE**: Do NOTHING, create NO files
4. **concept.md exists + CODE exists**: Modify concept.md + transform existing code

**CODE DETECTION CRITERIA:**
- Any .py, .js, .ts, .html, .css files
- Any package.json, pyproject.toml, requirements.txt files
- Any src/, lib/, app/ directories with code files

**FORBIDDEN ACTIONS when NO CODE detected:**
- ‚ùå Creating .gitignore
- ‚ùå Creating pyproject.toml, package.json, or ANY config files
- ‚ùå Creating ANY new files whatsoever
- ‚ùå Executing Phase 2 or Phase 3
- ‚úÖ ONLY modify existing concept.md (if it exists)

### Transformation Process

The process executes in three systematic phases:

#### Phase 1: Concept Alignment

**Step 1: Concept.md Assessment**
- **If concept.md exists**: Create backup and modify existing file
- **If concept.md missing**: Skip to Step 2 (code structure assessment)

**When concept.md exists:**
1. **Backup Creation**
   ```
   - Create concept.md.bonsai_backup_[timestamp]
   - Store original for rollback reference
   ```

2. **Concept.md Analysis & Modification**
   - **REMOVE**: Directory structures, tooling choices, design specifications
   - **PRESERVE**: Project-specific requirements (e.g., scikit-rf, chess engines)
   - **ADD**: References to BONSAI guidelines in CLAUDE.md
   - **MANDATORY**: Add BONSAI design system requirement

**Step 2: Code Structure Assessment**
- **If existing code structure present**: Apply BONSAI structure adaptation in Phase 2
- **If no code structure exists**: Skip Phase 2 AND Phase 3 (no transformation needed)

   Example transformation:
   ```markdown
   <!-- BEFORE -->
   ## Project Structure
   src/
   ‚îú‚îÄ‚îÄ components/
   ‚îú‚îÄ‚îÄ controllers/
   ‚îî‚îÄ‚îÄ utils/

   ## Tools
   - Formatter: black
   - UI: Material-UI

   ## Design System
   - Colors: Custom brand palette
   - Typography: Custom fonts
   - Logging: Basic console output

   <!-- AFTER -->
   ## Project Structure
   See BONSAI structure guidelines in CLAUDE.md

   ## Tools  
   See BONSAI tool standards in CLAUDE.md
   Additional project-specific tools:
   - scikit-rf (RF circuit analysis)

   ## Design & Visual Standards
   **MANDATORY**: All visual elements follow BONSAI design system from CLAUDE.md
   - **Color Palette**: Use BONSAI color system (dark zen aesthetic)
   - **Typography**: BONSAI font guidelines (Quicksand/JetBrains Mono)
   - **UI Components**: BONSAI component design principles
   - **Logging Output**: Rich library with BONSAI color palette
   - **Data Visualization**: BONSAI matplotlib theme
   - **Console Styling**: BONSAI rich console integration
   ```

3. **Tool Migration Mapping**
   ```
   Common Replacements:
   ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
   black + isort + flake8 ‚Üí ruff
   Material-UI ‚Üí BONSAI design + Tailwind
   Redux ‚Üí zustand  
   webpack ‚Üí vite
   npm ‚Üí yarn/pnpm
   unittest ‚Üí pytest
   Prettier (aggressive) ‚Üí Prettier (minimal config)
   matplotlib (default theme) ‚Üí BONSAI matplotlib theme
   rich (default colors) ‚Üí BONSAI rich color palette
   ```

#### Phase 2: Directory Reconstruction (Conditional)

**üö® CRITICAL RULE: Execute ONLY if existing code structure detected**
**If no code files exist (.py, .js, .html, package.json, pyproject.toml, etc.), SKIP Phase 2 entirely**

**Progressive Structure Migration**:

1. **Detect Current Structure**
   - Analyze existing organization
   - Identify framework patterns
   - Map file relationships

2. **Apply BONSAI Progressive Structure**
   ```
   # Example: Overly complex structure
   BEFORE:                      AFTER:
   src/                         backend.py
   ‚îú‚îÄ‚îÄ api/                     frontend.html
   ‚îÇ   ‚îú‚îÄ‚îÄ routes/             README.md
   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/
   ‚îÇ   ‚îî‚îÄ‚îÄ controllers/
   ‚îú‚îÄ‚îÄ models/
   ‚îú‚îÄ‚îÄ services/
   ‚îî‚îÄ‚îÄ utils/
   ```

3. **Update Path References**
   - Fix imports
   - Update config files
   - Maintain functionality

#### Phase 3: Deep Integration (Conditional)

**üö® CRITICAL RULE: Execute ONLY if existing code structure detected**
**If no code files exist, SKIP Phase 3 entirely - DO NOT create any configuration files**

1. **Design System Migration (MANDATORY - only if code exists)**
   - **Replace ALL color schemes** with BONSAI color palette
   - **Update ALL component styling** to BONSAI design principles
   - **Apply Dark Zen principles** throughout interface
   - **MANDATORY matplotlib integration**: Apply BONSAI matplotlib theme and color palettes
   - **MANDATORY rich library integration**: Apply BONSAI colors to console logging and panels
   - **Typography updates**: Implement BONSAI font guidelines (Quicksand/JetBrains Mono)
   - **Component redesign**: Apply BONSAI UI component principles
   - **Logging transformation**: Replace standard logging with BONSAI rich console styling

2. **Tooling Updates**
   - Install BONSAI-preferred tools
   - Create minimal configurations
   - Update package.json/pyproject.toml scripts

3. **Code Adjustments**
   - Update formatter/linter configs
   - Apply BONSAI code style
   - Remove unnecessary abstractions
   - **If matplotlib used**: Replace default styling with BONSAI theme application
   - **If rich used**: Update console colors and panel styling with BONSAI palette

### Process Documentation

**BONSAI_IT_PROCESS.md** (auto-generated, add to .gitignore):

```markdown
# BONSAI Transformation Report
Generated: [timestamp]
Original Request: "BONSAI it!"

## Compatibility Analysis
- concept.md exists: [YES/NO]
- Existing code structure: [YES/NO - code files detected]
- Framework: [detected framework/NONE]
- Matplotlib usage: [YES/NO - files using matplotlib]
- Rich library usage: [YES/NO - files using rich console/logging]
- Data visualization patterns: [count of .py files with plt/matplotlib imports]
- Console output patterns: [count of .py files with rich imports]
- Complexity: [LOW/MEDIUM/HIGH]
- Risk Assessment: [details]

## Phase 1: Concept Alignment
### Step 1: Concept.md Assessment
- concept.md found: [YES/NO]
- Action taken: [BACKUP_AND_MODIFY/SKIP_TO_STEP_2]

### Backup Created (if concept.md exists)
- concept.md ‚Üí concept.md.bonsai_backup_[timestamp]

### Modifications (if concept.md exists)
- Removed: [list of removed sections]
- Preserved: [project-specific tools/requirements]
- Added: BONSAI references

### Step 2: Code Structure Assessment  
- Existing code detected: [YES/NO]
- Phase 2 required: [YES/NO]

## Phase 2: Directory Reconstruction (Conditional)
### Execution Status
- Phase executed: [YES/NO - based on code structure detection]
- Reason: [Code structure found/No code structure to transform]

### Structure Changes (if executed)
BEFORE:
[tree output]

AFTER:
[tree output]

### Path Updates (if executed)
- Updated imports: [count]
- Fixed references: [count]
- Maintained functionality: [YES/NO]

## Phase 3: Deep Integration
### Tool Migrations
- black ‚Üí ruff ‚úì
- Material-UI ‚Üí BONSAI design ‚úì
- matplotlib ‚Üí BONSAI matplotlib theme ‚úì
- rich ‚Üí BONSAI rich color palette ‚úì
- [other migrations]

### Design Updates
- Colors migrated: [count]
- Components updated: [count]
- Matplotlib theme applied: [YES/NO/N/A]
- Rich console colors applied: [YES/NO/N/A]
- BONSAI color palettes integrated: [YES/NO/N/A]
- Styling aligned: [YES/NO]

### Issues Requiring Attention
‚ö†Ô∏è MANUAL INTERVENTION NEEDED:
- [Issue 1: description and suggested fix]
- [Issue 2: description and suggested fix]

### Verification Results
- Build: [PASS/FAIL]
- Tests: [X/Y passing]
- Linting: [CLEAN/X issues]

## Rollback Instructions
If you need to undo this transformation:
1. Restore concept.md from concept.md.bonsai_backup_[timestamp]
2. Review file changes in git
3. Restore previous tool configurations

## Summary
‚úÖ Successfully Transformed:
- Files modified: [count]
- Tools migrated: [count]  
- Structure aligned: [YES/NO]

‚ö†Ô∏è Requires Attention:
- [List of manual fixes needed]

üå± Welcome to the BONSAI garden!
Your project has been thoughtfully cultivated to grow with minimal, purposeful intention.

[BONSAI seed symbol]
```

### Advanced Options

**Partial Transformations** (when specified):
- `BONSAI it! --tooling`: Only update development tools
- `BONSAI it! --structure`: Only reorganize directories  
- `BONSAI it! --design`: Only update visual styling

### Exclusions

**.bonsai-ignore** file support:
```
# Legacy code to preserve
legacy/
vendor/

# Generated files
*.generated.js
*_pb2.py

# Third-party integrations
external-api-wrapper.js
```

### Automatic Design System Integration

**MANDATORY BONSAI DESIGN ENFORCEMENT**: Every "BONSAI it!" transformation automatically adds comprehensive design system requirements to concept.md:

```markdown
## Design & Visual Standards
**MANDATORY**: All visual elements follow BONSAI design system from CLAUDE.md

### Color System
- **Primary Palette**: BONSAI color system (dark zen aesthetic)
- **Background Colors**: BONSAI_background_deep through BONSAI_background_overlay
- **Text Colors**: BONSAI_text_primary, secondary, muted hierarchy
- **Accent Colors**: BONSAI green/red/blue/yellow families
- **Semantic Colors**: Success, warning, error, info mappings

### Typography
- **Primary Font**: Quicksand (300-600 weights) for UI text
- **Code Font**: JetBrains Mono (300-500 weights) for code display
- **Hierarchy**: Consistent font-weight and size scaling
- **Line Height**: 1.6-1.7 for comfortable reading

### Visualization Standards
- **Matplotlib**: BONSAI matplotlib theme (dark background, BONSAI colors)
- **Rich Console**: BONSAI color palette for logging and terminal output
- **Data Charts**: BONSAI color palettes (qualitative, sequential, diverging)
- **UI Components**: BONSAI component design principles

### Implementation Requirements
- **NO custom color schemes** - use only BONSAI palette
- **NO custom fonts** - use only BONSAI typography guidelines
- **MANDATORY rich integration** - if logging exists, use BONSAI rich styling
- **MANDATORY matplotlib theming** - if visualization exists, use BONSAI themes
```

**This design system section is AUTOMATICALLY added to every concept.md during "BONSAI it!" transformation**, ensuring consistent visual identity across all BONSAI projects.

### Critical Implementation Rules

1. **Highest Priority**: Keep the application functional
   - If functionality would break, document it instead of changing
   - Preserve business logic completely
   - Test after each phase

2. **Progressive Enhancement**
   - Start with least disruptive changes
   - Build confidence with each phase
   - Allow stopping between phases

3. **Documentation First**
   - Every change logged in BONSAI_IT_PROCESS.md
   - Clear rollback instructions
   - Known issues highlighted

4. **Smart Detection**
   - Recognize meta-frameworks (Next.js, Django, etc.)
   - Identify CI/CD dependencies
   - Check for hard tool dependencies

### Implementation Within BONSAI Workflow

When "BONSAI it!" is triggered, it executes WITHIN the standard 18-task workflow:
- Task 0-3: Analysis and planning specific to transformation
- Task 4-7: Execute Phases 1-2 (Implementation and environment setup)
- Task 8-11: Execute Phase 3 (Testing and concept validation)
- Task 12: Formatting & Linting (after all changes)
- Task 13-17: Final validation and documentation

The command follows all BONSAI workflow rules while performing its specific transformation logic.

## üå± GROW! - Multi-Prompt Orchestration System

**GROW!** introduces a temporary third instance "Orchestrator" that analyzes concept.md, generates a smart phase-based development plan, creates prompts for each phase, and executes them sequentially with full tracking and progress monitoring.

### Command Activation

**Standard Mode**: **"GROW!"**
- Executes next available phase in sequence
- Stops after completing current phase
- User can continue with next "GROW!" command

**Continuous Mode**: **"GROW! --ALL"**
- Executes all phases automatically from first to last
- No stops between phases
- Completes entire project development in one execution

### System Architecture

**Triple-Instance System (Temporary)**:
- **Instance 1**: BONSAI Compliance Overseer (existing)
- **Instance 2**: Technical Executor (existing)  
- **Instance 3**: Orchestrator (new, temporary)

### Orchestration Process

#### Phase 1: Analysis & Planning
1. **Read concept.md** - Analyze project vision and requirements
2. **Generate development phases** - Smart, natural progression (backend ‚Üí testing ‚Üí CLI ‚Üí frontend, etc.)
3. **Create phase prompts** - Each phase generates functional increment
4. **Initialize GROW.md** - Document complete plan and prompts
5. **Instance 3 Activation** - Temporary orchestrator starts

#### Phase 2: Sequential Execution

**Standard Mode (GROW!)**:
- Execute next incomplete phase only
- Stop after phase completion
- Return control to user

**Continuous Mode (GROW! --ALL)**:
- Execute all phases from first incomplete to last phase
- No user interaction between phases
- Automatic progression through entire development plan

**For each phase prompt in GROW.md:**

1. **Instance 3 sends prompt** to Instance 1
2. **Instance 1 performs compliance check** (standard BONSAI process)
3. **Instance 2 executes task** (standard workflow or bypass behavior)
4. **CRITICAL --ALL MODE**: Instance 2 MUST complete ALL 18 tasks continuously without stopping
5. **Instance 1 signals completion** to Instance 3 with summary ONLY after all 18 tasks complete
6. **Instance 3 updates GROW.md** with results and progress
   - **üö® MANDATORY VERIFICATION**: Instance 3 MUST update GROW.md after EVERY phase completion
   - **üö® ENFORCEMENT TRIGGER**: If Instance 3 fails to update GROW.md, Instance 1 MUST intervene and force update
   - **üö® VERIFICATION PROTOCOL**: Instance 1 must verify GROW.md shows phase as COMPLETED before proceeding
   - **üö® HARDCODED CHECK**: Before continuing to next phase, Instance 1 MUST read GROW.md and confirm current phase status is "‚úÖ COMPLETED"
   - **üö® AUTOMATIC CORRECTION**: If GROW.md is not updated, Instance 1 MUST automatically update it with completion status
7. **Phase validation** - Ensure phase is fully functional before proceeding
8. **Mode check**:
   - Standard mode: Stop and return to user
   - --ALL mode: Continue to next phase automatically

**üö® CRITICAL --ALL MODE EXECUTION FIX**:
- **MANDATORY**: When GROW! --ALL is active, Instance 2 MUST execute all 18 tasks in continuous sequence
- **FORBIDDEN**: Stopping workflow after any single task completion in --ALL mode
- **REQUIRED**: Instance 1 must oversee continuous execution until all 18 tasks complete
- **NO EXCEPTIONS**: --ALL mode means complete phase execution, not partial task execution

#### Phase 3: Completion

**üö® MANDATORY DUAL-VERIFICATION BEFORE PHASE PROGRESSION**:
1. **Instance 2 Completion**: Verify BONSAI.md shows all 18 tasks complete
2. **Instance 3 Documentation**: Verify GROW.md shows current phase as "‚úÖ COMPLETED"
3. **Cross-Reference Check**: Verify phase completion timestamps match between BONSAI.md and GROW.md
4. **BLOCKING RULE**: No phase progression allowed until BOTH verifications pass

**Final Phase Completion**:
1. **Final summary** generated in GROW.md
2. **Instance 3 deactivation** - Returns to dual-instance system
3. **Results delivered** to user

### GROW.md Enhanced Structure

**Auto-generated planning and tracking file**:
```markdown
# GROW! Intelligent Development Plan
## Project Analysis: [timestamp]
## Source: concept.md

### Concept Analysis
- **Project Type**: [web app/CLI tool/library/API/etc.]
- **Core Technology**: [Python/JavaScript/etc.]
- **Complexity Level**: [Simple/Medium/Complex]
- **Key Requirements**: [list from concept.md]

### Development Phases (Human-Like Progression)

#### Phase 1: [Foundation Phase Name]
- **Goal**: [what this phase achieves]
- **Deliverable**: [functional component]
- **Justification**: [why this phase comes first]
- **Estimated Complexity**: [SIMPLE/MEDIUM/COMPLEX]

#### Phase 2: [Next Logical Phase]
- **Goal**: [builds upon Phase 1]
- **Deliverable**: [next functional increment]
- **Dependencies**: [requires Phase 1 completion]
- **Estimated Complexity**: [SIMPLE/MEDIUM/COMPLEX]

[... additional phases ...]

### Generated Prompts

#### Phase 1 Prompt:
```
[Smart prompt for Phase 1 that will create fully functional foundation]
```

#### Phase 2 Prompt:
```
[Smart prompt for Phase 2 that builds upon Phase 1]
```

[... additional prompts ...]

### Execution Log

#### Phase 1: [Foundation Phase Name]
- **Status**: ‚úÖ COMPLETED / ‚è≥ RUNNING / ‚ùå FAILED
- **Prompt**: [the actual prompt sent]
- **Compliance Check**: [BYPASS/BONSAI]
- **Workflow Type**: [Normal Claude Code / 18-Task BONSAI]
- **Summary**: [Instance 1 completion summary]
- **Files Modified**: [list]
- **Validation**: [proof phase is functional]
- **Timestamp**: [completion time]

#### Phase 2: [Next Phase Name]
- **Status**: ‚è≥ RUNNING
- **Dependencies Met**: [Phase 1 ‚úÖ]
[... etc ...]

### Project Status
- **Current Phase**: [X of Y]
- **Overall Progress**: [percentage]
- **Functional Status**: [each phase working status]
- **Next Actions**: [what comes after completion]
```

### Error Handling Protocol

**If Phase Fails**:
1. Instance 3 logs error in GROW.md
2. Marks phase as FAILED with reason
3. **Dependency Check**: Determine if next phases can proceed
4. **User Choice**: Fix current phase, skip to independent phase, or abort
5. Maintains execution history for debugging

**If concept.md Missing**:
1. Instance 3 creates template concept.md
2. Requests user to define project vision
3. Continues analysis when concept.md is ready

**üö® GROW.md UPDATE FAILURE RECOVERY**:
- **Detection**: If Instance 1 detects GROW.md is not updated after phase completion
- **Automatic Action**: Instance 1 immediately updates GROW.md with completion details
- **Evidence Required**: Extract completion details from BONSAI.md for GROW.md update
- **No User Intervention**: Recovery happens automatically without user notification
- **Logging**: Record recovery action in both BONSAI.md and GROW.md

**Phase Validation Protocol**:
1. Each phase must produce working, testable functionality
2. Dependencies verified before proceeding to next phase
3. No "placeholder" or "TODO" implementations allowed
4. Each phase represents a complete development milestone

### Integration with BONSAI Workflow

**Critical Rule**: GROW! does NOT bypass compliance checks
- Each generated phase prompt goes through Instance 1
- Compliance check determines workflow type (BONSAI vs bypass)
- Instance 3 orchestrates intelligent phase planning and prompt delivery
- All existing BONSAI rules and Instance 1/2 behavior remain unchanged
- Phase-based development follows BONSAI minimalism principles

### Intelligent Phase Planning Examples

**Example 1: Simple CLI Tool**
Based on concept.md describing a "task management CLI":
- **Phase 1**: Core task data structure and basic operations
- **Phase 2**: File persistence and data validation  
- **Phase 3**: Command-line interface and argument parsing
- **Phase 4**: Testing suite and error handling

**Example 2: Web Application**
Based on concept.md describing a "user management web app":
- **Phase 1**: Backend API with core user operations
- **Phase 2**: Database integration and data validation
- **Phase 3**: Authentication and authorization system
- **Phase 4**: Frontend interface (HTML/CSS/JS)
- **Phase 5**: Integration testing and deployment prep

**Example 3: Python Library**
Based on concept.md describing a "data processing library":
- **Phase 1**: Core algorithms and data structures
- **Phase 2**: Public API design and implementation
- **Phase 3**: Comprehensive test suite
- **Phase 4**: Documentation and examples
- **Phase 5**: Package setup and distribution

### Execution Mode Examples

**Incremental Development (Standard)**:
```
User: GROW!
‚Üí Executes Phase 1 only, stops
User: GROW!  
‚Üí Executes Phase 2 only, stops
User: GROW!
‚Üí Executes Phase 3 only, stops
[... continue manually for each phase]
```

**Complete Project Development (Continuous)**:
```
User: GROW! --ALL
‚Üí Executes Phase 1 ‚Üí Phase 2 ‚Üí Phase 3 ‚Üí ... ‚Üí Final Phase
‚Üí Complete project delivered in single execution
‚Üí No manual intervention required between phases
```

**Resume from Middle (Continuous)**:
```
# If Phases 1-2 already complete
User: GROW! --ALL
‚Üí Detects completed phases, starts from Phase 3
‚Üí Executes Phase 3 ‚Üí Phase 4 ‚Üí ... ‚Üí Final Phase
‚Üí Completes remaining development automatically
```

### Smart Phase Generation Process

**Instance 3 Analysis Workflow**:
1. **Parse concept.md** - Extract project type, technology, requirements
2. **Identify natural phases** - Determine logical development progression
3. **Validate dependencies** - Ensure each phase builds functionally on previous
4. **Generate phase prompts** - Create specific, actionable prompts for each phase
5. **Estimate complexity** - Assess time/effort for realistic planning

**Phase Generation Principles**:
- **Foundation First**: Always start with core functionality
- **Incremental Value**: Each phase adds working features
- **Natural Dependencies**: Backend before frontend, core before extensions
- **Testable Milestones**: Every phase produces verifiable functionality
- **BONSAI Alignment**: Minimal viable implementation at each step

**Human-Like Development Simulation**:
- How would a developer naturally approach this project?
- What would they build first to validate the concept?
- Which components need to work before others can be built?
- When would they add testing, documentation, deployment?

### Security & Safety

**Safeguards**:
- Each generated prompt still requires compliance check
- No automatic bypass of safety measures
- User can review generated plan in GROW.md before execution
- Progress tracked in GROW.md for accountability
- Can abort execution at any point
- Phase validation ensures working functionality at each step

**Limitations**:
- Maximum 10 phases per project (keeps development focused)
- Each phase prompt subject to standard Claude Code limits
- Instance 3 deactivates after completion (no persistent state)
- Requires well-defined concept.md for effective phase planning

### File Management

**Auto-generated Files**:
- **GROW.md**: Comprehensive plan and execution log (can commit to repo for project history)
- **concept.md**: User maintains (project vision document)

**Cleanup**:
- GROW.md persists as project development history
- Instance 3 fully deactivates after session
- System returns to standard dual-instance operation
- All phase deliverables remain as functional project components

### Remember

**GROW! extends BONSAI with intelligent orchestration**:
- Compliance checks remain mandatory for every phase
- Workflow rules still apply to each generated prompt
- Analyzes concept.md to create smart development phases
- Simulates natural human development progression
- Ensures each phase produces working functionality
- Provides comprehensive planning and execution tracking
- Temporary third instance for intelligent coordination only

The GROW! system enables sophisticated project development automation while maintaining all BONSAI safety, quality, and minimalism standards. Each phase represents a complete, functional milestone in the project's natural evolution.
